<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Food Rescue Matchmaker</title>
    <style>
        /* Modern Color Scheme Variables */
        :root {
            --primary-gradient: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            --secondary-gradient: linear-gradient(135deg, #f093fb 0%, #f5576c 100%);
            --success-gradient: linear-gradient(135deg, #4facfe 0%, #00f2fe 100%);
            --warning-gradient: linear-gradient(135deg, #43e97b 0%, #38f9d7 100%);
            --accent-gradient: linear-gradient(135deg, #fa709a 0%, #fee140 100%);
            
            --primary-color: #667eea;
            --secondary-color: #764ba2;
            --accent-color: #f093fb;
            --success-color: #4facfe;
            --warning-color: #43e97b;
            --danger-color: #f5576c;
            
            --dark-bg: #1a1a2e;
            --dark-secondary: #16213e;
            --dark-accent: #0f3460;
            
            --light-bg: #f8faff;
            --light-secondary: #ffffff;
            --light-accent: #e8f2ff;
            
            --text-primary: #2d3748;
            --text-secondary: #4a5568;
            --text-light: #718096;
            --text-white: #ffffff;
            
            --shadow-sm: 0 2px 4px rgba(102, 126, 234, 0.1);
            --shadow-md: 0 4px 6px rgba(102, 126, 234, 0.15);
            --shadow-lg: 0 10px 25px rgba(102, 126, 234, 0.2);
            --shadow-xl: 0 20px 40px rgba(102, 126, 234, 0.25);
        }

        * { 
            margin: 0; 
            padding: 0; 
            box-sizing: border-box; 
        }
        
        body { 
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            line-height: 1.6; 
            color: var(--text-primary);
            background: var(--light-bg);
        }
        
        .container { 
            max-width: 1200px; 
            margin: 0 auto; 
            padding: 20px; 
        }
        
        .header { 
            background: var(--primary-gradient);
            color: var(--text-white); 
            padding: 1rem; 
            text-align: center;
            box-shadow: var(--shadow-lg);
        }
        
        .nav { 
            display: flex; 
            gap: 20px; 
            justify-content: center; 
            margin: 20px 0; 
            padding: 20px;
            background: var(--light-secondary);
            border-radius: 15px;
            box-shadow: var(--shadow-md);
        }
        
        .nav button, .nav-btn { 
            padding: 12px 24px; 
            background: var(--primary-gradient);
            color: var(--text-white); 
            border: none; 
            border-radius: 10px; 
            cursor: pointer;
            font-weight: 600;
            transition: all 0.3s ease;
            box-shadow: var(--shadow-sm);
        }
        
        .nav button.active, .nav-btn.active { 
            background: var(--secondary-gradient);
            transform: translateY(-2px);
            box-shadow: var(--shadow-lg);
        }
        
        .nav button:hover, .nav-btn:hover { 
            background: var(--accent-gradient);
            transform: translateY(-2px);
            box-shadow: var(--shadow-md);
        }
        
        .dashboard { 
            display: none; 
            background: var(--light-secondary);
            border-radius: 15px;
            padding: 30px;
            margin: 20px 0;
            box-shadow: var(--shadow-lg);
        }
        
        .dashboard.active { 
            display: block; 
        }
        
        .form-group { 
            margin: 20px 0; 
        }
        
        .form-group label { 
            display: block; 
            margin-bottom: 8px; 
            font-weight: 600;
            color: var(--text-primary);
        }
        
        .form-group input, .form-group textarea, .form-group select { 
            width: 100%; 
            padding: 12px 16px; 
            border: 2px solid var(--light-accent);
            border-radius: 10px;
            font-size: 16px;
            transition: all 0.3s ease;
            background: var(--light-bg);
        }
        
        .form-group input:focus, .form-group textarea:focus, .form-group select:focus {
            outline: none;
            border-color: var(--primary-color);
            box-shadow: 0 0 0 3px rgba(102, 126, 234, 0.1);
            background: var(--light-secondary);
        }
        
        .btn { 
            padding: 12px 24px; 
            background: var(--success-gradient);
            color: var(--text-white); 
            border: none; 
            border-radius: 10px; 
            cursor: pointer; 
            margin: 10px 5px;
            font-weight: 600;
            transition: all 0.3s ease;
            box-shadow: var(--shadow-sm);
        }
        
        .btn:hover {
            transform: translateY(-2px);
            box-shadow: var(--shadow-md);
        }
        
        .btn-danger {
            background: var(--secondary-gradient);
        }
        
        .btn-primary {
            background: var(--primary-gradient);
        }
        
        .btn-warning {
            background: var(--warning-gradient);
            color: var(--text-primary);
        }
        
        /* Enhanced Login Page Styles */
        .login-container {
            display: flex;
            justify-content: center;
            align-items: center;
            min-height: 100vh;
            background: var(--primary-gradient);
            padding: 20px;
        }
        
        .login-card {
            background: var(--light-secondary);
            border-radius: 20px;
            padding: 40px;
            box-shadow: var(--shadow-xl);
            width: 100%;
            max-width: 450px;
            position: relative;
            backdrop-filter: blur(10px);
        }
        
        .login-header {
            text-align: center;
            margin-bottom: 30px;
        }
        
        .login-title {
            font-size: 2.5rem;
            background: var(--primary-gradient);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
            margin-bottom: 10px;
        }
        
        .login-subtitle {
            color: var(--text-secondary);
            font-size: 1.1rem;
        }
        
        .tab-container {
            display: flex;
            margin-bottom: 30px;
            background: var(--light-accent);
            border-radius: 10px;
            padding: 5px;
        }
        
        .tab-btn {
            flex: 1;
            padding: 12px 20px;
            background: transparent;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            font-weight: 600;
            color: var(--text-secondary);
            transition: all 0.3s ease;
        }
        
        .tab-btn.active {
            background: var(--primary-gradient);
            color: var(--text-white);
            box-shadow: var(--shadow-sm);
        }
        
        .form-group-enhanced {
            margin: 20px 0;
        }
        
        .form-group-enhanced label {
            display: block;
            margin-bottom: 8px;
            font-weight: 600;
            color: var(--text-primary);
        }
        
        .form-input-enhanced {
            width: 100%;
            padding: 15px 20px;
            border: 2px solid var(--light-accent);
            border-radius: 12px;
            font-size: 16px;
            transition: all 0.3s ease;
            background: var(--light-bg);
        }
        
        .form-input-enhanced:focus {
            outline: none;
            border-color: var(--primary-color);
            box-shadow: 0 0 0 3px rgba(102, 126, 234, 0.1);
            background: var(--light-secondary);
        }
        
        .btn-enhanced {
            width: 100%;
            padding: 15px;
            background: var(--primary-gradient);
            color: var(--text-white);
            border: none;
            border-radius: 12px;
            font-size: 16px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            box-shadow: var(--shadow-md);
        }
        
        .btn-enhanced:hover {
            transform: translateY(-2px);
            box-shadow: var(--shadow-lg);
        }
        
        /* Card Styles */
        .donation-card {
            background: var(--light-secondary);
            border-radius: 15px;
            padding: 25px;
            margin: 20px 0;
            box-shadow: var(--shadow-md);
            border-left: 4px solid var(--primary-color);
            transition: all 0.3s ease;
        }
        
        .donation-card:hover {
            transform: translateY(-3px);
            box-shadow: var(--shadow-lg);
        }
        
        .donation-card h3 {
            color: var(--text-primary);
            margin-bottom: 15px;
            font-size: 1.3rem;
        }
        
        .donation-card .status {
            display: inline-block;
            padding: 6px 12px;
            border-radius: 20px;
            font-size: 0.85rem;
            font-weight: 600;
            margin-bottom: 10px;
        }
        
        .status.available {
            background: var(--warning-gradient);
            color: var(--text-primary);
        }
        
        .status.claimed {
            background: var(--success-gradient);
            color: var(--text-white);
        }
        
        .status.completed {
            background: var(--secondary-gradient);
            color: var(--text-white);
        }
        
        /* Notification Styles */
        .notification {
            position: fixed;
            top: 20px;
            right: 20px;
            padding: 15px 25px;
            border-radius: 10px;
            color: var(--text-white);
            font-weight: 600;
            box-shadow: var(--shadow-lg);
            z-index: 1000;
            animation: slideIn 0.3s ease;
        }
        
        .notification.success {
            background: var(--success-gradient);
        }
        
        .notification.error {
            background: var(--secondary-gradient);
        }
        
        .notification.warning {
            background: var(--warning-gradient);
            color: var(--text-primary);
        }
        
        @keyframes slideIn {
            from {
                transform: translateX(100%);
                opacity: 0;
            }
            to {
                transform: translateX(0);
                opacity: 1;
            }
        }
        .btn-secondary { background: #95a5a6; }
        .btn-secondary:hover { background: #7f8c8d; }
        .donations-grid { display: grid; grid-template-columns: repeat(auto-fill, minmax(300px, 1fr)); gap: 20px; margin: 20px 0; }
        .donation-card { border: 1px solid #ddd; padding: 20px; border-radius: 10px; background: white; box-shadow: 0 2px 5px rgba(0,0,0,0.1); }
        .status { padding: 5px 10px; border-radius: 15px; color: white; font-size: 12px; }
        .status.available { background: #27ae60; }
        .status.accepted { background: #f39c12; }
        .status.picked_up { background: #3498db; }
        .status.delivered { background: #9b59b6; }
        .stats-grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 20px; margin: 20px 0; }
        .stat-card { background: #ecf0f1; padding: 20px; border-radius: 10px; text-align: center; }
        .stat-number { font-size: 2em; font-weight: bold; color: var(--text-primary); }
        .photo-upload { border: 2px dashed #ddd; padding: 40px; text-align: center; border-radius: 10px; cursor: pointer; }
        .photo-upload:hover { border-color: var(--primary-color); }
        .notification { padding: 10px; margin: 10px 0; border-radius: 5px; }
        .notification.success { background: var(--light-success); color: var(--success-color); }
        .notification.error { background: var(--light-danger); color: var(--danger-color); }
        
        /* Map embed styles */
        .map-container { 
            border-radius: 8px; 
            overflow: hidden; 
            box-shadow: 0 2px 8px rgba(0,0,0,0.15);
            transition: box-shadow 0.3s ease;
        }
        .map-container:hover {
            box-shadow: 0 4px 12px rgba(0,0,0,0.25);
        }
        .map-container iframe {
            display: block;
            border: none;
        }
        .location-info {
            background: rgba(255,255,255,0.95);
            backdrop-filter: blur(5px);
            border-radius: 6px;
            padding: 10px;
            margin: 8px 0;
            border-left: 4px solid #007bff;
        }
        
        /* Food type checkbox styling */
        .food-type-checkbox {
            transition: all 0.2s ease;
        }
        .food-type-checkbox:hover {
            background-color: var(--light-primary);
            border-color: var(--primary-color) !important;
        }
        .food-type-checkbox input[type="checkbox"]:checked + span {
            font-weight: bold;
            color: var(--text-primary);
        }
        .food-type-checkbox:has(input[type="checkbox"]:checked) {
            background-color: var(--light-secondary);
            border-color: var(--secondary-color) !important;
            box-shadow: 0 2px 4px rgba(118, 75, 162, 0.2);
        }
        
        /* Role selection styling */
        .role-card:hover {
            border-color: var(--primary-color) !important;
            background-color: var(--light-primary) !important;
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(52, 152, 219, 0.2);
        }
        
        /* Enhanced login page styling */
        .login-container {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            display: flex;
            align-items: center;
            justify-content: center;
            position: relative;
            overflow: hidden;
        }
        
        .login-container::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: url('data:image/svg+xml,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 1000 1000"><defs><radialGradient id="a" cx="50%" cy="50%"><stop offset="0%" stop-color="%23ffffff" stop-opacity="0.1"/><stop offset="100%" stop-color="%23ffffff" stop-opacity="0"/></radialGradient></defs><circle cx="200" cy="200" r="100" fill="url(%23a)"/><circle cx="800" cy="300" r="150" fill="url(%23a)"/><circle cx="300" cy="700" r="120" fill="url(%23a)"/><circle cx="900" cy="800" r="80" fill="url(%23a)"/></svg>');
            opacity: 0.5;
            animation: float 6s ease-in-out infinite;
        }
        
        @keyframes float {
            0%, 100% { transform: translateY(0px); }
            50% { transform: translateY(-20px); }
        }
        
        .login-card {
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(10px);
            border-radius: 20px;
            padding: 40px;
            box-shadow: 0 20px 40px rgba(0, 0, 0, 0.1);
            border: 1px solid rgba(255, 255, 255, 0.2);
            position: relative;
            z-index: 10;
            max-width: 450px;
            width: 90%;
            animation: slideUp 0.8s ease-out;
        }
        
        @keyframes slideUp {
            from { opacity: 0; transform: translateY(30px); }
            to { opacity: 1; transform: translateY(0); }
        }
        
        .login-header {
            text-align: center;
            margin-bottom: 30px;
        }
        
        .login-title {
            font-size: 2.5em;
            margin-bottom: 10px;
            background: linear-gradient(135deg, #667eea, #764ba2);
            -webkit-background-clip: text;
            background-clip: text;
            -webkit-text-fill-color: transparent;
            font-weight: bold;
        }
        
        .login-subtitle {
            color: #666;
            font-size: 1.1em;
            margin: 0;
        }
        
        .form-group-enhanced {
            margin-bottom: 25px;
            position: relative;
        }
        
        .form-group-enhanced label {
            display: block;
            margin-bottom: 8px;
            font-weight: 600;
            color: #2c3e50;
            font-size: 0.95em;
        }
        
        .form-input-enhanced {
            width: 100%;
            padding: 15px 20px;
            border: 2px solid #e1e8ed;
            border-radius: 12px;
            font-size: 16px;
            transition: all 0.3s ease;
            background: rgba(255, 255, 255, 0.9);
        }
        
        .form-input-enhanced:focus {
            outline: none;
            border-color: #667eea;
            box-shadow: 0 0 0 4px rgba(102, 126, 234, 0.1);
            transform: translateY(-2px);
        }
        
        .btn-enhanced {
            width: 100%;
            padding: 16px;
            background: linear-gradient(135deg, #667eea, #764ba2);
            color: white;
            border: none;
            border-radius: 12px;
            font-size: 16px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            position: relative;
            overflow: hidden;
        }
        
        .btn-enhanced:hover {
            transform: translateY(-2px);
            box-shadow: 0 10px 20px rgba(102, 126, 234, 0.3);
        }
        
        .btn-enhanced:active {
            transform: translateY(0);
        }
        
        .btn-enhanced:disabled {
            opacity: 0.7;
            cursor: not-allowed;
            transform: none;
        }
        
        .loading {
            position: relative;
        }
        
        .loading::after {
            content: '';
            position: absolute;
            width: 20px;
            height: 20px;
            border: 2px solid transparent;
            border-top: 2px solid white;
            border-radius: 50%;
            animation: spin 1s linear infinite;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
        }
        
        @keyframes spin {
            0% { transform: translate(-50%, -50%) rotate(0deg); }
            100% { transform: translate(-50%, -50%) rotate(360deg); }
        }
        
        .error-message {
            color: #e74c3c;
            font-size: 0.9em;
            margin-top: 5px;
            display: none;
        }
        
        .success-message {
            color: #27ae60;
            font-size: 0.9em;
            margin-top: 5px;
            display: none;
        }
        
        .tab-container {
            display: flex;
            margin-bottom: 30px;
            background: #f8f9fa;
            border-radius: 12px;
            padding: 4px;
        }
        
        .tab-btn {
            flex: 1;
            padding: 12px;
            background: transparent;
            border: none;
            border-radius: 8px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            color: #666;
        }
        
        .tab-btn.active {
            background: white;
            color: #667eea;
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
        }
        
        /* Enhanced role selection styling */
        .role-selection-container {
            background: linear-gradient(135deg, #f093fb 0%, #f5576c 100%);
            min-height: 100vh;
            display: flex;
            align-items: center;
            justify-content: center;
            position: relative;
        }
        
        .role-selection-card {
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(10px);
            border-radius: 20px;
            padding: 50px;
            box-shadow: 0 20px 40px rgba(0, 0, 0, 0.1);
            max-width: 800px;
            width: 90%;
            animation: slideUp 0.8s ease-out;
        }
        
        .role-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 25px;
            margin-top: 30px;
        }
        
        .role-card-enhanced {
            background: white;
            border: 3px solid #e1e8ed;
            border-radius: 16px;
            padding: 40px 20px;
            text-align: center;
            cursor: pointer;
            transition: all 0.3s ease;
            position: relative;
            overflow: hidden;
        }
        
        .role-card-enhanced::before {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg, transparent, rgba(255,255,255,0.4), transparent);
            transition: left 0.5s ease;
        }
        
        .role-card-enhanced:hover::before {
            left: 100%;
        }
        
        .role-card-enhanced:hover {
            transform: translateY(-5px);
            border-color: #667eea;
            box-shadow: 0 15px 30px rgba(102, 126, 234, 0.2);
        }
        
        .role-icon {
            font-size: 4em;
            margin-bottom: 20px;
            display: block;
        }
        
        .role-title {
            font-size: 1.4em;
            font-weight: bold;
            color: #2c3e50;
            margin-bottom: 10px;
        }
        
        .role-description {
            color: #666;
            font-size: 0.95em;
            line-height: 1.5;
        }
        
        /* User info styling */
        .user-info {
            position: absolute;
            top: 20px;
            right: 20px;
            background: rgba(255,255,255,0.95);
            padding: 10px 15px;
            border-radius: 8px;
            border: 1px solid #ddd;
            font-size: 14px;
            color: #2c3e50;
        }
        .logout-btn {
            background: #e74c3c;
            color: white;
            border: none;
            padding: 5px 10px;
            border-radius: 4px;
            cursor: pointer;
            margin-left: 10px;
            font-size: 12px;
        }
        .logout-btn:hover {
            background: #c0392b;
        }
        
        /* Enhanced Home Page Styles */
        .home-page {
            display: block;
            background: var(--primary-gradient);
            min-height: 100vh;
        }
        
        .hero {
            background: linear-gradient(135deg, 
                rgba(102, 126, 234, 0.9), 
                rgba(118, 75, 162, 0.9), 
                rgba(240, 147, 251, 0.8)
            );
            color: var(--text-white);
            padding: 6rem 0;
            text-align: center;
            position: relative;
            overflow: hidden;
        }
        
        .hero::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: url('data:image/svg+xml,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 100 100"><circle cx="20" cy="20" r="2" fill="%23ffffff" opacity="0.1"/><circle cx="80" cy="80" r="3" fill="%23ffffff" opacity="0.1"/><circle cx="50" cy="10" r="1" fill="%23ffffff" opacity="0.1"/></svg>');
            animation: float 20s ease-in-out infinite;
        }
        
        @keyframes float {
            0%, 100% { transform: translateY(0px) rotate(0deg); }
            50% { transform: translateY(-20px) rotate(5deg); }
        }
        
        .hero h1 {
            font-size: 4rem;
            margin-bottom: 1rem;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.3);
            animation: fadeInUp 1s ease;
        }
        
        .hero p {
            font-size: 1.4rem;
            margin-bottom: 2rem;
            text-shadow: 1px 1px 2px rgba(0,0,0,0.3);
            animation: fadeInUp 1s ease 0.3s both;
        }
        
        @keyframes fadeInUp {
            from {
                opacity: 0;
                transform: translateY(30px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }
        
        .home-btn {
            display: inline-block;
            background: var(--accent-gradient);
            color: var(--text-white);
            padding: 15px 35px;
            text-decoration: none;
            border: none;
            border-radius: 30px;
            font-weight: bold;
            font-size: 1.1rem;
            cursor: pointer;
            transition: all 0.3s ease;
            box-shadow: var(--shadow-lg);
            animation: fadeInUp 1s ease 0.6s both;
            margin: 0 10px;
        }
        
        .home-btn:hover {
            transform: translateY(-3px);
            box-shadow: var(--shadow-xl);
            background: var(--secondary-gradient);
        }
        
        .home-btn.secondary {
            background: var(--success-gradient);
            box-shadow: var(--shadow-lg);
        }
        
        .home-btn.secondary:hover {
            background: var(--warning-gradient);
            color: var(--text-primary);
            box-shadow: var(--shadow-xl);
        }
        
        .top-performers {
            padding: 5rem 0;
            background: var(--light-secondary);
            backdrop-filter: blur(10px);
        }
        
        .top-performers h2 {
            text-align: center;
            font-size: 3rem;
            margin-bottom: 3rem;
            background: var(--accent-gradient);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }
        
        .performers-section {
            margin-bottom: 4rem;
        }
        
        .performers-section h3 {
            text-align: center;
            font-size: 2rem;
            margin-bottom: 2rem;
            color: var(--text-primary);
            background: var(--primary-gradient);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }
        
        .performers-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(320px, 1fr));
            gap: 2rem;
            max-width: 1200px;
            margin: 0 auto;
        }
        
        .performer-card {
            background: var(--light-secondary);
            padding: 2.5rem;
            border-radius: 20px;
            box-shadow: var(--shadow-lg);
            text-align: center;
            transition: all 0.3s ease;
            position: relative;
            overflow: hidden;
        }
        
        .performer-card::before {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg, transparent, rgba(102, 126, 234, 0.1), transparent);
            transition: left 0.5s ease;
        }
        
        .performer-card:hover::before {
            left: 100%;
        }
        
        .performer-card:hover {
            transform: translateY(-10px);
            box-shadow: var(--shadow-xl);
        }
        
        .performer-card.gold {
            border: 3px solid var(--primary-color);
            background: linear-gradient(135deg, rgba(102, 126, 234, 0.1), var(--light-secondary));
        }
        
        .performer-card.silver {
            border: 3px solid var(--secondary-color);
            background: linear-gradient(135deg, rgba(118, 75, 162, 0.1), var(--light-secondary));
        }
        
        .performer-card.bronze {
            border: 3px solid var(--accent-color);
            background: linear-gradient(135deg, rgba(240, 147, 251, 0.1), var(--light-secondary));
        }
        
        .performer-icon {
            font-size: 5rem;
            margin-bottom: 1.5rem;
            display: block;
        }
        
        .performer-icon.gold {
            background: linear-gradient(135deg, #f39c12, #e67e22);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }
        
        .performer-icon.silver {
            background: linear-gradient(135deg, #95a5a6, #7f8c8d);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }
        
        .performer-icon.bronze {
            background: linear-gradient(135deg, #cd7f32, #8d5524);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }
        
        .performer-name {
            color: var(--text-primary);
            margin-bottom: 1rem;
            font-size: 1.4rem;
            font-weight: bold;
        }
        
        .performer-stats {
            color: var(--accent-color);
            font-size: 1.3rem;
            font-weight: bold;
            margin-bottom: 1rem;
        }
        
        .performer-desc {
            color: var(--text-secondary);
            line-height: 1.6;
            margin-bottom: 1.5rem;
        }
        
        .performer-badge {
            background: linear-gradient(135deg, #e8f5e8, #d5f4e6);
            padding: 15px;
            border-radius: 15px;
            font-size: 0.9rem;
            font-weight: 600;
            color: #27ae60;
            box-shadow: 0 4px 15px rgba(0,0,0,0.1);
        }
        
        .stats-section {
            background: linear-gradient(135deg, rgba(44, 62, 80, 0.95), rgba(52, 73, 94, 0.95));
            color: white;
            padding: 5rem 0;
            text-align: center;
        }
        
        .stats-section h2 {
            font-size: 3rem;
            margin-bottom: 3rem;
            background: linear-gradient(135deg, #3498db, #2ecc71);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }
        
        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 2rem;
            max-width: 1000px;
            margin: 0 auto;
        }
        
        .stat-item {
            padding: 2rem 1rem;
            background: rgba(255, 255, 255, 0.1);
            border-radius: 15px;
            backdrop-filter: blur(10px);
            transition: all 0.3s ease;
        }
        
        .stat-item:hover {
            transform: translateY(-5px);
            background: rgba(255, 255, 255, 0.15);
        }
        
        .stat-number {
            font-size: 3.5rem;
            font-weight: bold;
            margin-bottom: 0.5rem;
            background: linear-gradient(135deg, #e74c3c, #f39c12);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }
        
        .stat-label {
            font-size: 1.2rem;
            font-weight: 600;
        }
        
        /* Reward Cards */
        .reward-card {
            background: var(--bg-secondary);
            border: 2px solid transparent;
            border-radius: 15px;
            padding: 25px;
            transition: all 0.3s ease;
            position: relative;
            overflow: hidden;
        }
        
        .reward-card::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 4px;
            background: var(--accent-gradient);
        }
        
        .reward-card:hover {
            border-color: var(--accent-color);
            transform: translateY(-3px);
            box-shadow: var(--shadow-lg);
        }
        
        .reward-card.affordable {
            border-color: var(--success-color);
            background: var(--light-success);
        }
        
        .reward-card.expensive {
            border-color: var(--text-secondary);
            background: var(--bg-secondary);
            opacity: 0.7;
        }
        
        .reward-icon {
            font-size: 3rem;
            margin-bottom: 15px;
            text-align: center;
        }
        
        .reward-name {
            font-size: 1.3rem;
            font-weight: bold;
            color: var(--text-primary);
            margin-bottom: 10px;
        }
        
        .reward-description {
            color: var(--text-secondary);
            margin-bottom: 15px;
            line-height: 1.5;
        }
        
        .reward-cost {
            font-size: 1.1rem;
            font-weight: 600;
            color: var(--accent-color);
            margin-bottom: 15px;
        }
        
        .redeem-btn {
            background: var(--accent-gradient);
            color: var(--text-light);
            border: none;
            padding: 10px 20px;
            border-radius: 20px;
            cursor: pointer;
            font-size: 0.9rem;
            font-weight: 600;
            transition: all 0.3s ease;
            width: 100%;
        }
        
        .redeem-btn:hover {
            transform: translateY(-2px);
            box-shadow: var(--shadow-md);
        }
        
        .redeem-btn:disabled {
            background: var(--text-secondary);
            cursor: not-allowed;
            transform: none;
        }
    </style>
</head>
<body>
    <!-- Home Page -->
    <div id="home-page" class="home-page">
        <!-- Hero Section -->
        <section class="hero">
            <div class="container">
                <h1>üåü Save Food, Feed People üåü</h1>
                <p>‚ú® Join our mission to reduce food waste and fight hunger in our communities ‚ú®</p>
                <div>
                    <button class="home-btn" onclick="showDashboard('login-page')">üöÄ Get Started</button>
                    <button class="home-btn secondary" onclick="scrollToTopPerformers()">üèÜ View Top Performers</button>
                </div>
            </div>
        </section>

        <!-- Top Performers Section -->
        <section class="top-performers" id="top-performers">
            <div class="container">
                <h2>üèÜ Top Performers üèÜ</h2>
                
                <!-- Top 3 Donors -->
                <div class="performers-section">
                    <h3>üçΩÔ∏è Top 3 Donors</h3>
                    <div class="performers-grid">
                        <div class="performer-card gold">
                            <div class="performer-icon gold">ü•á</div>
                            <h4 class="performer-name">Green Valley Restaurant</h4>
                            <div class="performer-stats">2,850 meals donated</div>
                            <p class="performer-desc">üå± Leading sustainable restaurant with zero-waste policy. Daily donations of fresh, organic meals to local shelters.</p>
                            <div class="performer-badge">
                                üìç Downtown ‚Ä¢ ‚≠ê 98% success rate ‚Ä¢ üî• Hot streak: 45 days
                            </div>
                        </div>
                        
                        <div class="performer-card silver">
                            <div class="performer-icon silver">ü•à</div>
                            <h4 class="performer-name">Urban Kitchen</h4>
                            <div class="performer-stats">2,200 meals donated</div>
                            <p class="performer-desc">üè¢ Multi-location chain committed to community impact. Innovative food rescue program across 15 locations.</p>
                            <div class="performer-badge">
                                üìç City Center ‚Ä¢ ‚≠ê 95% success rate ‚Ä¢ üìà Growing fast
                            </div>
                        </div>
                        
                        <div class="performer-card bronze">
                            <div class="performer-icon bronze">ü•â</div>
                            <h4 class="performer-name">Spice Garden</h4>
                            <div class="performer-stats">1,950 meals donated</div>
                            <p class="performer-desc">üçõ Family-owned restaurant specializing in traditional recipes. Weekly community feast programs.</p>
                            <div class="performer-badge">
                                üìç Old Town ‚Ä¢ ‚≠ê 92% success rate ‚Ä¢ üéØ Consistent performer
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Top 3 NGOs -->
                <div class="performers-section">
                    <h3>üèõÔ∏è Top 3 NGOs</h3>
                    <div class="performers-grid">
                        <div class="performer-card gold">
                            <div class="performer-icon gold">üèÜ</div>
                            <h4 class="performer-name">Akshaya Patra Foundation</h4>
                            <div class="performer-stats">8,500 meals served</div>
                            <p class="performer-desc">üåç World's largest school meal program, serving millions daily. Technology-driven solutions for efficient distribution.</p>
                            <div class="performer-badge">
                                üë• 2,200 children fed ‚Ä¢ üìç Multiple locations ‚Ä¢ üöÄ Fastest response
                            </div>
                        </div>
                        
                        <div class="performer-card silver">
                            <div class="performer-icon silver">üåü</div>
                            <h4 class="performer-name">Smile Foundation</h4>
                            <div class="performer-stats">6,200 meals served</div>
                            <p class="performer-desc">üí´ Empowering underprivileged communities through education and nutrition. Operating across 25 states.</p>
                            <div class="performer-badge">
                                üë• 1,800 families helped ‚Ä¢ üìç Nationwide ‚Ä¢ üí™ Most reliable
                            </div>
                        </div>
                        
                        <div class="performer-card bronze">
                            <div class="performer-icon bronze">‚úÖ</div>
                            <h4 class="performer-name">LEPRA Society</h4>
                            <div class="performer-stats">4,800 meals served</div>
                            <p class="performer-desc">üè• Healthcare-focused NGO providing medical care and nutrition. Specialized programs for remote communities.</p>
                            <div class="performer-badge">
                                üë• 1,100 patients supported ‚Ä¢ üìç Rural areas ‚Ä¢ üéØ Specialized care
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Top 3 Volunteers -->
                <div class="performers-section">
                    <h3>‚≠ê Top 3 Volunteers</h3>
                    <div class="performers-grid">
                        <div class="performer-card gold">
                            <div class="performer-icon gold">üë©‚Äçüíº</div>
                            <h4 class="performer-name">Sarah Chen</h4>
                            <div class="performer-stats">1,500 hours served</div>
                            <p class="performer-desc">üåü Dedicated community coordinator with 6+ years experience. Leads volunteer teams and organizes distribution drives.</p>
                            <div class="performer-badge">
                                üéØ 120 events led ‚Ä¢ ‚≠ê Community Leader ‚Ä¢ üöÄ Top motivator
                            </div>
                        </div>
                        
                        <div class="performer-card silver">
                            <div class="performer-icon silver">üë®‚Äçüíª</div>
                            <h4 class="performer-name">Michael Rodriguez</h4>
                            <div class="performer-stats">1,200 hours served</div>
                            <p class="performer-desc">üíª Software engineer and platform architect. Created this rescue system and provides ongoing technical support.</p>
                            <div class="performer-badge">
                                üíª 85 features built ‚Ä¢ ‚≠ê Tech Lead ‚Ä¢ üõ†Ô∏è Platform creator
                            </div>
                        </div>
                        
                        <div class="performer-card bronze">
                            <div class="performer-icon bronze">üë©‚Äç‚öïÔ∏è</div>
                            <h4 class="performer-name">Dr. Anita Desai</h4>
                            <div class="performer-stats">1,000 hours served</div>
                            <p class="performer-desc">üè• Nutritionist and food safety expert. Ensures all donated food meets health standards and provides education.</p>
                            <div class="performer-badge">
                                üî¨ 200 inspections ‚Ä¢ ‚≠ê Health Expert ‚Ä¢ üéì Educator
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </section>

        <!-- Stats Section -->
        <section class="stats-section">
            <div class="container">
                <h2>üéØ Our Impact</h2>
                <div class="stats-grid">
                    <div class="stat-item">
                        <div class="stat-number">2,500+</div>
                        <div class="stat-label">üçΩÔ∏è Meals Rescued</div>
                    </div>
                    <div class="stat-item">
                        <div class="stat-number">150+</div>
                        <div class="stat-label">üè™ Restaurants</div>
                    </div>
                    <div class="stat-item">
                        <div class="stat-number">45+</div>
                        <div class="stat-label">üèõÔ∏è NGO Partners</div>
                    </div>
                    <div class="stat-item">
                        <div class="stat-number">1,000+</div>
                        <div class="stat-label">üë• People Fed</div>
                    </div>
                </div>
            </div>
        </section>
    </div>

    <div class="header" style="display: none;">
        <h1>üçΩÔ∏è Food Rescue Matchmaker</h1>
        <p>Connecting surplus food with those who need it</p>
    </div>

    <!-- Enhanced Login Page -->
    <div id="login-page" class="login-container" style="display: none;">
        <div class="login-card">
            <div class="login-header">
                <button onclick="goToHome()" style="position: absolute; top: 20px; left: 20px; background: transparent; border: none; font-size: 2rem; cursor: pointer; color: #3498db;" title="Back to Home">üè†</button>
                <h1 class="login-title">üçΩÔ∏è Food Rescue</h1>
                <p class="login-subtitle">Connect. Share. Impact.</p>
            </div>
            
            <div class="tab-container">
                <button class="tab-btn active" onclick="switchTab('login')">Login</button>
                <button class="tab-btn" onclick="switchTab('register')">Register</button>
            </div>
            
            <!-- Login Form -->
            <form id="login-form" style="display: block;">
                <div class="form-group-enhanced">
                    <label>Username</label>
                    <input type="text" id="login-username" class="form-input-enhanced" autocomplete="username" required placeholder="Enter your username">
                </div>
                
                <div class="form-group-enhanced">
                    <label>Password</label>
                    <input type="password" id="login-password" class="form-input-enhanced" autocomplete="current-password" required placeholder="Enter your password">
                </div>
                
                <button type="submit" class="btn-enhanced">
                    üöÄ Sign In
                </button>
            </form>
            
            <!-- Register Form -->
            <form id="register-form" style="display: none;">
                <div class="form-group-enhanced">
                    <label>Full Name</label>
                    <input type="text" id="register-name" class="form-input-enhanced" required placeholder="Enter your full name">
                </div>
                
                <div class="form-group-enhanced">
                    <label>Username</label>
                    <input type="text" id="register-username" class="form-input-enhanced" autocomplete="username" required placeholder="Choose a username">
                </div>
                
                <div class="form-group-enhanced">
                    <label>Password</label>
                    <input type="password" id="register-password" class="form-input-enhanced" autocomplete="new-password" required placeholder="Create a password">
                </div>
                
                <div class="form-group-enhanced">
                    <label>Email</label>
                    <input type="email" id="register-email" class="form-input-enhanced" required placeholder="Enter your email">
                </div>
                
                <button type="submit" class="btn-enhanced">
                    ‚ú® Create Account
                </button>
            </form>
        </div>
    </div>

    <!-- Enhanced Role Selection Page -->
    <div id="role-selection-page" class="role-selection-container" style="display: none;">
        <div class="role-selection-card">
            <div style="text-align: center; margin-bottom: 20px;">
                <h2 style="font-size: 2.5em; margin-bottom: 10px; background: linear-gradient(135deg, #f093fb, #f5576c); -webkit-background-clip: text; background-clip: text; -webkit-text-fill-color: transparent; font-weight: bold;">Choose Your Role</h2>
                <p style="color: #666; font-size: 1.2em;">How would you like to make an impact today?</p>
            </div>
            
            <div class="role-grid">
                <div class="role-card-enhanced" onclick="selectRole('donor')">
                    <span class="role-icon">üçû</span>
                    <h3 class="role-title">Food Donor</h3>
                    <p class="role-description">Share surplus food from your restaurant, event, or home with those in need</p>
                </div>
                
                <div class="role-card-enhanced" onclick="selectRole('ngo')">
                    <span class="role-icon">üè¢</span>
                    <h3 class="role-title">NGO Partner</h3>
                    <p class="role-description">Accept and distribute food donations to serve your community</p>
                </div>
                
                <div class="role-card-enhanced" onclick="selectRole('admin')">
                    <span class="role-icon">üìä</span>
                    <h3 class="role-title">Platform Admin</h3>
                    <p class="role-description">Monitor platform performance and track community impact</p>
                </div>
            </div>
        </div>
    </div>

    <div class="container" id="main-app" style="display: none;">
        <!-- User Info -->
        <div class="user-info" id="user-info" style="display: none;">
            <span id="user-display"></span>
            <button class="logout-btn" onclick="logout()">üö™ Logout</button>
        </div>
        
        <div class="nav" id="main-nav">
            <button onclick="showDashboard('donor')" class="nav-btn active" id="donor-btn">üçû Donor Dashboard</button>
            <button onclick="showDashboard('ngo')" class="nav-btn" id="ngo-btn">üè¢ NGO Dashboard</button>
            <button onclick="showDashboard('volunteer')" class="nav-btn" id="volunteer-btn">ü§ù Volunteer Dashboard</button>
        </div>

        <!-- Donor Dashboard -->
        <div id="donor-dashboard" class="dashboard active">
            <h2>üçû Restaurant/Donor Dashboard</h2>
            
            <div class="form-group">
                <h3>Post New Food Donation</h3>
                <form id="donation-form">
                    <div class="form-group">
                        <label>Restaurant Name *</label>
                        <input type="text" id="restaurant-name" required>
                    </div>
                    
                    <div class="form-group">
                        <label>Food Type</label>
                        <div id="donor-food-types" style="display: grid; grid-template-columns: repeat(auto-fit, minmax(150px, 1fr)); gap: 8px; margin-top: 8px;">
                            <label class="food-type-checkbox" style="display: flex; align-items: center; gap: 8px; padding: 8px; border: 1px solid #ddd; border-radius: 4px; cursor: pointer;">
                                <input type="checkbox" value="Vegetables" name="donor-food-types">
                                <span>ü•¨ Vegetables</span>
                            </label>
                            <label class="food-type-checkbox" style="display: flex; align-items: center; gap: 8px; padding: 8px; border: 1px solid #ddd; border-radius: 4px; cursor: pointer;">
                                <input type="checkbox" value="Fruits" name="donor-food-types">
                                <span>üçé Fruits</span>
                            </label>
                            <label class="food-type-checkbox" style="display: flex; align-items: center; gap: 8px; padding: 8px; border: 1px solid #ddd; border-radius: 4px; cursor: pointer;">
                                <input type="checkbox" value="Dairy" name="donor-food-types">
                                <span>ü•õ Dairy</span>
                            </label>
                            <label class="food-type-checkbox" style="display: flex; align-items: center; gap: 8px; padding: 8px; border: 1px solid #ddd; border-radius: 4px; cursor: pointer;">
                                <input type="checkbox" value="Bakery" name="donor-food-types">
                                <span>üçû Bakery</span>
                            </label>
                            <label class="food-type-checkbox" style="display: flex; align-items: center; gap: 8px; padding: 8px; border: 1px solid #ddd; border-radius: 4px; cursor: pointer;">
                                <input type="checkbox" value="Meat" name="donor-food-types">
                                <span>ü•© Meat</span>
                            </label>
                            <label class="food-type-checkbox" style="display: flex; align-items: center; gap: 8px; padding: 8px; border: 1px solid #ddd; border-radius: 4px; cursor: pointer;">
                                <input type="checkbox" value="Canned Goods" name="donor-food-types">
                                <span>ü•´ Canned Goods</span>
                            </label>
                            <label class="food-type-checkbox" style="display: flex; align-items: center; gap: 8px; padding: 8px; border: 1px solid #ddd; border-radius: 4px; cursor: pointer;">
                                <input type="checkbox" value="Prepared Meals" name="donor-food-types">
                                <span>üçΩÔ∏è Prepared Meals</span>
                            </label>
                            <label class="food-type-checkbox" style="display: flex; align-items: center; gap: 8px; padding: 8px; border: 1px solid #ddd; border-radius: 4px; cursor: pointer;">
                                <input type="checkbox" value="Other" name="donor-food-types">
                                <span>üì¶ Other</span>
                            </label>
                        </div>
                        <small>Select all food types in your donation</small>
                    </div>
                    
                    <div class="form-group">
                        <label>Food Description *</label>
                        <textarea id="food-description" rows="3" required placeholder="Describe the food items in detail..."></textarea>
                    </div>
                    
                    <div class="form-group">
                        <label>Quantity (servings) *</label>
                        <input type="number" id="quantity" required min="1">
                    </div>
                    
                    <div class="form-group">
                        <label>Expiry Hours</label>
                        <input type="number" id="expiry-hours" min="1" max="72" placeholder="Hours until food expires (optional)">
                        <small style="color: #666; font-size: 0.8em;">How many hours from now will this food expire?</small>
                    </div>
                    
                    <div class="form-group">
                        <label>Photo Upload</label>
                        <div class="photo-upload" onclick="document.getElementById('photo-input').click()">
                            <input type="file" id="photo-input" accept="image/*" style="display: none" onchange="handlePhotoUpload(this)">
                            <p>üì∑ Click to upload photo or drag and drop</p>
                            <div id="photo-preview"></div>
                        </div>
                    </div>
                    
                    <div class="form-group">
                        <button type="button" class="btn" onclick="getLocation()">üìç Get My Location</button>
                        <span id="location-status"></span>
                    </div>
                    
                    <button type="submit" class="btn">üöÄ Post Donation</button>
                </form>
            </div>

            <div class="donations-grid" id="my-donations">
                <!-- My donations will be populated here -->
            </div>
        </div>

        <!-- NGO Dashboard -->
        <div id="ngo-dashboard" class="dashboard">
            <h2>üè¢ NGO Dashboard</h2>
            
            <div class="form-group">
                <h3>Register Your NGO</h3>
                <form id="ngo-form">
                    <div class="form-group">
                        <label>NGO Name *</label>
                        <input type="text" id="ngo-name" required>
                    </div>
                    
                    <div class="form-group">
                        <label>Contact Phone *</label>
                        <input type="tel" id="ngo-phone" required>
                    </div>
                    
                    <div class="form-group">
                        <label>Accepted Food Types</label>
                        <div id="ngo-food-types" style="display: grid; grid-template-columns: repeat(auto-fit, minmax(150px, 1fr)); gap: 8px; margin-top: 8px;">
                            <label class="food-type-checkbox" style="display: flex; align-items: center; gap: 8px; padding: 8px; border: 1px solid #ddd; border-radius: 4px; cursor: pointer;">
                                <input type="checkbox" value="Vegetables" name="food-types">
                                <span>ü•¨ Vegetables</span>
                            </label>
                            <label class="food-type-checkbox" style="display: flex; align-items: center; gap: 8px; padding: 8px; border: 1px solid #ddd; border-radius: 4px; cursor: pointer;">
                                <input type="checkbox" value="Fruits" name="food-types">
                                <span>üçé Fruits</span>
                            </label>
                            <label class="food-type-checkbox" style="display: flex; align-items: center; gap: 8px; padding: 8px; border: 1px solid #ddd; border-radius: 4px; cursor: pointer;">
                                <input type="checkbox" value="Dairy" name="food-types">
                                <span>ü•õ Dairy</span>
                            </label>
                            <label class="food-type-checkbox" style="display: flex; align-items: center; gap: 8px; padding: 8px; border: 1px solid #ddd; border-radius: 4px; cursor: pointer;">
                                <input type="checkbox" value="Bakery" name="food-types">
                                <span>üçû Bakery</span>
                            </label>
                            <label class="food-type-checkbox" style="display: flex; align-items: center; gap: 8px; padding: 8px; border: 1px solid #ddd; border-radius: 4px; cursor: pointer;">
                                <input type="checkbox" value="Meat" name="food-types">
                                <span>ü•© Meat</span>
                            </label>
                            <label class="food-type-checkbox" style="display: flex; align-items: center; gap: 8px; padding: 8px; border: 1px solid #ddd; border-radius: 4px; cursor: pointer;">
                                <input type="checkbox" value="Canned Goods" name="food-types">
                                <span>ü•´ Canned Goods</span>
                            </label>
                            <label class="food-type-checkbox" style="display: flex; align-items: center; gap: 8px; padding: 8px; border: 1px solid #ddd; border-radius: 4px; cursor: pointer;">
                                <input type="checkbox" value="Prepared Meals" name="food-types">
                                <span>üçΩÔ∏è Prepared Meals</span>
                            </label>
                            <label class="food-type-checkbox" style="display: flex; align-items: center; gap: 8px; padding: 8px; border: 1px solid #ddd; border-radius: 4px; cursor: pointer;">
                                <input type="checkbox" value="Other" name="food-types">
                                <span>üì¶ Other</span>
                            </label>
                        </div>
                        <small>Select all food types your NGO can accept</small>
                    </div>
                    
                    <div class="form-group">
                        <label>Storage Capacity (meals per day)</label>
                        <input type="number" id="ngo-capacity" min="1" placeholder="e.g., 100">
                    </div>
                    
                    <div class="form-group">
                        <label>Operating Schedule</label>
                        <select id="ngo-schedule">
                            <option value="24/7">24/7 Operations</option>
                            <option value="Business Hours">Business Hours (9-5)</option>
                            <option value="Extended Hours">Extended Hours (7-9)</option>
                            <option value="Weekdays Only">Weekdays Only</option>
                            <option value="Weekends Only">Weekends Only</option>
                            <option value="Custom">Custom Schedule</option>
                        </select>
                    </div>
                    
                    <button type="submit" class="btn">üìù Register NGO</button>
                </form>
            </div>

            <div id="ngo-food-preferences" style="display: none; margin: 20px 0; padding: 15px; background: #e3f2fd; border-radius: 8px;">
                <h4 style="margin: 0 0 10px 0; color: #1976d2;">üçΩÔ∏è Your Accepted Food Types</h4>
                <div id="accepted-food-types-display" style="display: flex; flex-wrap: wrap; gap: 8px;"></div>
                <p style="margin: 10px 0 0 0; font-size: 0.9em; color: #666;">Only donations matching these food types will be shown below.</p>
            </div>

            <h3>Available Donations</h3>
            <div class="donations-grid" id="available-donations">
                <!-- Available donations will be populated here -->
            </div>

            <h3>My Accepted Pickups</h3>
            <div class="donations-grid" id="my-pickups">
                <!-- My pickups will be populated here -->
            </div>
        </div>

        <!-- Volunteer Dashboard -->
        <div id="volunteer-dashboard" class="dashboard">
            <h2>ü§ù Volunteer Dashboard</h2>
            <p style="color: var(--text-secondary); margin-bottom: 30px; font-size: 1.1rem;">Help rescue food and make a difference in your community</p>

            <div class="stats-grid" style="margin-bottom: 30px;">
                <div class="stat-card" style="background: var(--primary-gradient); color: var(--text-light); text-align: center; padding: 25px; border-radius: 15px;">
                    <div style="font-size: 3rem; margin-bottom: 15px;">üèÜ</div>
                    <div style="font-size: 2.5rem; font-weight: bold; margin-bottom: 10px;" id="volunteer-total-accepted">0</div>
                    <div style="font-size: 1.1rem; opacity: 0.9;">Donations Accepted</div>
                </div>
                <div class="stat-card" style="background: var(--success-gradient); color: var(--text-light); text-align: center; padding: 25px; border-radius: 15px;">
                    <div style="font-size: 3rem; margin-bottom: 15px;">üçΩÔ∏è</div>
                    <div style="font-size: 2.5rem; font-weight: bold; margin-bottom: 10px;" id="volunteer-meals-rescued">0</div>
                    <div style="font-size: 1.1rem; opacity: 0.9;">Meals Rescued</div>
                </div>
                <div class="stat-card" style="background: var(--warning-gradient); color: var(--text-light); text-align: center; padding: 25px; border-radius: 15px;">
                    <div style="font-size: 3rem; margin-bottom: 15px;">‚≠ê</div>
                    <div style="font-size: 2.5rem; font-weight: bold; margin-bottom: 10px;" id="volunteer-impact-score">0</div>
                    <div style="font-size: 1.1rem; opacity: 0.9;">Impact Score</div>
                </div>
            </div>

            <!-- Rewards Section -->
            <div style="background: var(--bg-primary); border-radius: 20px; padding: 30px; box-shadow: var(--shadow-xl); margin-bottom: 30px;">
                <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 25px; padding-bottom: 15px; border-bottom: 2px solid var(--light-primary);">
                    <h3 style="background: var(--accent-gradient); -webkit-background-clip: text; -webkit-text-fill-color: transparent; background-clip: text; font-size: 2rem; font-weight: bold;">ÔøΩÔ∏è Restaurant Vouchers</h3>
                    <div style="display: flex; align-items: center; gap: 15px;">
                        <div style="background: var(--warning-gradient); color: var(--text-light); padding: 8px 16px; border-radius: 20px; font-weight: 600;">
                            üíé <span id="volunteer-points-display">0</span> Points
                        </div>
                        <button onclick="loadRewards()" style="background: var(--accent-gradient); color: var(--text-light); border: none; padding: 12px 20px; border-radius: 25px; cursor: pointer; font-size: 1rem; font-weight: 600; box-shadow: var(--shadow-md);">
                            üîÑ Refresh
                        </button>
                    </div>
                </div>
                
                <div style="background: var(--light-warning); padding: 15px; border-radius: 10px; margin-bottom: 20px; border-left: 4px solid var(--warning-color);">
                    <div style="color: var(--text-primary); font-weight: 600; margin-bottom: 5px;">ü§ù Restaurant Appreciation Program:</div>
                    <div style="color: var(--text-secondary); font-size: 0.9rem;">When you help restaurants reduce food waste by delivering their donations to NGOs, they show their appreciation by giving YOU discount vouchers! The better your delivery service (higher ratings), the bigger their thank you discount (10%-20% off your next meal at THE SAME restaurant you helped).</div>
                </div>
                
                <div id="rewards-grid" style="display: grid; grid-template-columns: repeat(auto-fit, minmax(300px, 1fr)); gap: 20px;">
                    <!-- Rewards will be populated here -->
                </div>
            </div>

            <div style="background: var(--bg-primary); border-radius: 20px; padding: 30px; box-shadow: var(--shadow-xl);">
                <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 25px; padding-bottom: 15px; border-bottom: 2px solid var(--light-primary);">
                    <h3 style="background: var(--primary-gradient); -webkit-background-clip: text; -webkit-text-fill-color: transparent; background-clip: text; font-size: 2rem; font-weight: bold;">üö® Available Donations</h3>
                    <button onclick="refreshVolunteerDonations()" style="background: var(--primary-gradient); color: var(--text-light); border: none; padding: 12px 20px; border-radius: 25px; cursor: pointer; font-size: 1rem; font-weight: 600; box-shadow: var(--shadow-md);">
                        üîÑ Refresh
                    </button>
                </div>
                
                <ul id="volunteer-donation-list" style="list-style: none; padding: 0;">
                    <li style="text-align: center; padding: 60px 20px; color: var(--text-secondary); font-size: 1.2rem; font-style: italic;">
                        <div style="font-size: 4rem; margin-bottom: 20px; opacity: 0.5;">üçΩÔ∏è</div>
                        <div>No donations available at the moment.</div>
                        <div style="margin-top: 10px; font-size: 1rem;">Check back soon for new opportunities to help!</div>
                    </li>
                </ul>
            </div>
        </div>
    </div>

    <div id="notifications"></div>
    </div> <!-- End main-app container -->

    <script>
        const API_BASE = 'http://127.0.0.1:8000/api';
        let currentNGO = null; // Will store complete NGO data object
        let currentLocation = null;
        let currentUser = null; // Will store current user info
        let userRole = null; // Will store current user role
        
        // Authentication and Role Management
        let registeredUsers = {
            'demo_donor': { password: 'demo123', name: 'Demo Restaurant', email: 'demo@restaurant.com' },
            'demo_ngo': { password: 'demo123', name: 'Demo NGO', email: 'demo@ngo.org' },
            'demo_admin': { password: 'demo123', name: 'Demo Admin', email: 'demo@admin.com' }
        };

        // WebSocket connection for real-time updates
        let websocket = null;
        let reconnectAttempts = 0;
        const maxReconnectAttempts = 3; // Reduced to prevent console spam
        let reconnectTimeout = null;

        // Initialize WebSocket connection (completely silent and transparent)
        function initWebSocket() {
            const wsProtocol = window.location.protocol === 'https:' ? 'wss:' : 'ws:';
            const wsUrl = `${wsProtocol}//127.0.0.1:8000/ws`;
            
            try {
                websocket = new WebSocket(wsUrl);
                
                websocket.onopen = function(event) {
                    console.log('üîå Real-time updates enabled');
                    reconnectAttempts = 0;
                    
                    // Clear any pending reconnect timeout
                    if (reconnectTimeout) {
                        clearTimeout(reconnectTimeout);
                        reconnectTimeout = null;
                    }
                };
                
                websocket.onmessage = function(event) {
                    try {
                        const message = JSON.parse(event.data);
                        handleWebSocketMessage(message);
                    } catch (error) {
                        console.error('‚ùå Error parsing message:', error);
                    }
                };
                
                websocket.onclose = function(event) {
                    // Only log on first disconnect to avoid spam
                    if (reconnectAttempts === 0) {
                        console.log('üîå Connection lost, switching to offline mode');
                    }
                    websocket = null;
                    
                    // Limit reconnection attempts to prevent spam
                    if (reconnectAttempts < 3) {
                        reconnectAttempts++;
                        const delay = Math.min(1000 * Math.pow(2, reconnectAttempts), 10000);
                        
                        // Only log first few attempts
                        if (reconnectAttempts <= 2) {
                            console.log(`üîÑ Reconnecting in ${delay/1000}s (attempt ${reconnectAttempts})`);
                        }
                        reconnectTimeout = setTimeout(initWebSocket, delay);
                    } else {
                        // Silent fallback after max attempts
                        if (!window.webSocketFallbackShown) {
                            console.log('üì° Backend unavailable - using offline mode');
                            window.webSocketFallbackShown = true;
                        }
                    }
                };
                
                websocket.onerror = function(error) {
                    // Only log error once to avoid spam
                    if (!window.webSocketErrorShown) {
                        console.log('üì° Backend server not running - offline mode active');
                        window.webSocketErrorShown = true;
                    }
                };
                
            } catch (error) {
                // Silent fallback for WebSocket creation errors
                if (!window.webSocketInitErrorShown) {
                    console.log('üì° WebSocket unavailable - using offline mode');
                    window.webSocketInitErrorShown = true;
                }
            }
        }

        // Handle incoming messages (completely transparent to user)
        function handleWebSocketMessage(message) {
            // console.log('üì® Live update received:', message.type);
            
            switch (message.type) {
                case 'new_donation':
                    handleNewDonationSilent(message.data);
                    break;
                case 'donation_accepted':
                    handleDonationAcceptedSilent(message.data);
                    break;
                case 'status_update':
                    handleStatusUpdateSilent(message.data);
                    break;
                case 'pickup_update':
                    handlePickupUpdateSilent(message.data);
                    break;
            }
        }

        // Silent handlers - just refresh data without notifications
        function handleNewDonationSilent(data) {
            // Refresh available donations silently
            const activeDashboard = document.querySelector('.dashboard.active').id;
            if (activeDashboard === 'ngo-dashboard') {
                loadAvailableDonations();
            }
            if (activeDashboard === 'volunteer-dashboard') {
                loadVolunteerData();
            }
        }

        function handleDonationAcceptedSilent(data) {
            // Refresh current view silently
            const activeDashboard = document.querySelector('.dashboard.active').id;
            if (activeDashboard === 'donor-dashboard') {
                loadMyDonations();
            } else if (activeDashboard === 'ngo-dashboard') {
                loadAvailableDonations();
            }
        }

        function handleStatusUpdateSilent(data) {
            // Refresh all relevant views silently
            const activeDashboard = document.querySelector('.dashboard.active').id;
            if (activeDashboard === 'donor-dashboard') {
                loadMyDonations();
            } else if (activeDashboard === 'ngo-dashboard') {
                loadAvailableDonations();
            } else if (activeDashboard === 'volunteer-dashboard') {
                loadVolunteerData();
            }
        }

        function handlePickupUpdateSilent(data) {
            // Refresh volunteer dashboard silently
            const activeDashboard = document.querySelector('.dashboard.active').id;
            if (activeDashboard === 'volunteer-dashboard') {
                loadVolunteerData();
            }
        }

        // Tab switching functionality
        function switchTab(tab) {
            const loginForm = document.getElementById('login-form');
            const registerForm = document.getElementById('register-form');
            const tabBtns = document.querySelectorAll('.tab-btn');
            
            tabBtns.forEach(btn => btn.classList.remove('active'));
            
            if (tab === 'login') {
                loginForm.style.display = 'block';
                registerForm.style.display = 'none';
                document.querySelector('.tab-btn').classList.add('active');
            } else {
                loginForm.style.display = 'none';
                registerForm.style.display = 'block';
                document.querySelectorAll('.tab-btn')[1].classList.add('active');
            }
        }

        // Login form submission
        document.getElementById('login-form').addEventListener('submit', function(e) {
            e.preventDefault();
            
            const submitBtn = e.target.querySelector('.btn-enhanced');
            const username = document.getElementById('login-username').value;
            const password = document.getElementById('login-password').value;
            
            // Add loading state
            submitBtn.classList.add('loading');
            submitBtn.disabled = true;
            submitBtn.textContent = '';
            
            // Simulate loading delay for better UX
            setTimeout(() => {
                if (registeredUsers[username] && registeredUsers[username].password === password) {
                    currentUser = { username, name: registeredUsers[username].name, email: registeredUsers[username].email };
                    document.getElementById('login-page').style.display = 'none';
                    document.getElementById('role-selection-page').style.display = 'flex';
                    showNotification(`Welcome back, ${currentUser.name}!`, 'success');
                } else {
                    showNotification('Invalid credentials. Try: demo_donor/demo123, demo_ngo/demo123, or demo_admin/demo123', 'error');
                }
                
                // Reset button
                submitBtn.classList.remove('loading');
                submitBtn.disabled = false;
                submitBtn.textContent = 'üöÄ Sign In';
            }, 1000);
        });

        // Register form submission
        document.getElementById('register-form').addEventListener('submit', function(e) {
            e.preventDefault();
            
            const submitBtn = e.target.querySelector('.btn-enhanced');
            const name = document.getElementById('register-name').value;
            const username = document.getElementById('register-username').value;
            const password = document.getElementById('register-password').value;
            const email = document.getElementById('register-email').value;
            
            // Basic validation
            if (password.length < 6) {
                showNotification('Password must be at least 6 characters long', 'error');
                return;
            }
            
            if (registeredUsers[username]) {
                showNotification('Username already exists. Please choose a different one.', 'error');
                return;
            }
            
            // Add loading state
            submitBtn.classList.add('loading');
            submitBtn.disabled = true;
            submitBtn.textContent = '';
            
            // Simulate loading delay
            setTimeout(() => {
                // Register new user
                registeredUsers[username] = { password, name, email };
                
                // Auto-login after registration
                currentUser = { username, name, email };
                document.getElementById('login-page').style.display = 'none';
                document.getElementById('role-selection-page').style.display = 'flex';
                showNotification(`Account created successfully! Welcome, ${name}!`, 'success');
                
                // Reset button
                submitBtn.classList.remove('loading');
                submitBtn.disabled = false;
                submitBtn.textContent = '‚ú® Create Account';
            }, 1500);
        });

        // Role selection
        function selectRole(role) {
            userRole = role;
            document.getElementById('role-selection-page').style.display = 'none';
            document.getElementById('main-app').style.display = 'block';
            
            // Update user info display
            document.getElementById('user-info').style.display = 'block';
            document.getElementById('user-display').textContent = `${currentUser.name} (${role.toUpperCase()})`;
            
            // Setup role-based interface
            setupRoleBasedInterface(role);
            
            showNotification(`Logged in as ${role.toUpperCase()}`, 'success');
        }

        // Setup interface based on role
        function setupRoleBasedInterface(role) {
            const donorBtn = document.getElementById('donor-btn');
            const ngoBtn = document.getElementById('ngo-btn');
            const volunteerBtn = document.getElementById('volunteer-btn');
            
            // Hide all nav buttons initially
            donorBtn.style.display = 'none';
            ngoBtn.style.display = 'none';
            volunteerBtn.style.display = 'none';
            
            // Show and activate appropriate dashboard based on role
            if (role === 'donor') {
                donorBtn.style.display = 'block';
                donorBtn.classList.add('active');
                showDashboard('donor');
            } else if (role === 'ngo') {
                ngoBtn.style.display = 'block';
                ngoBtn.classList.add('active');
                showDashboard('ngo');
            } else if (role === 'admin') {
                volunteerBtn.style.display = 'block';
                volunteerBtn.classList.add('active');
                showDashboard('volunteer');
            }
        }

        // Logout function
        function logout() {
            currentUser = null;
            userRole = null;
            currentNGO = null;
            
            // Reset interface
            document.getElementById('main-app').style.display = 'none';
            document.getElementById('role-selection-page').style.display = 'none';
            document.getElementById('login-page').style.display = 'flex';
            document.getElementById('user-info').style.display = 'none';
            
            // Reset forms
            document.getElementById('login-form').reset();
            document.getElementById('register-form').reset();
            switchTab('login'); // Switch back to login tab
            
            // Reset nav buttons
            document.querySelectorAll('.nav-btn').forEach(btn => {
                btn.style.display = 'block';
                btn.classList.remove('active');
            });
            
            showNotification('Logged out successfully', 'success');
        }

        // Date formatting utility
        function formatDate(dateString) {
            const date = new Date(dateString);
            const day = String(date.getDate()).padStart(2, '0');
            const month = String(date.getMonth() + 1).padStart(2, '0');
            const year = date.getFullYear();
            const hours = String(date.getHours()).padStart(2, '0');
            const minutes = String(date.getMinutes()).padStart(2, '0');
            return `${day}/${month}/${year} ${hours}:${minutes}`;
        }

        // Home page navigation functions
        function scrollToTopPerformers() {
            document.getElementById('top-performers').scrollIntoView({ 
                behavior: 'smooth' 
            });
        }

        function goToHome() {
            document.getElementById('home-page').style.display = 'block';
            document.getElementById('login-page').style.display = 'none';
            // Hide all dashboards
            document.querySelectorAll('.dashboard').forEach(d => d.classList.remove('active'));
        }

        // Navigation with role-based access control
        function showDashboard(type) {
            // Handle special case for login page
            if (type === 'login-page') {
                document.getElementById('home-page').style.display = 'none';
                document.getElementById('login-page').style.display = 'flex';
                return;
            }
            
            // Check if user has permission to access this dashboard
            if (userRole && userRole !== type && userRole !== 'admin') {
                showNotification(`Access denied: You don't have permission to view ${type} dashboard`, 'error');
                return;
            }
            
            document.querySelectorAll('.dashboard').forEach(d => d.classList.remove('active'));
            document.querySelectorAll('.nav-btn').forEach(b => b.classList.remove('active'));
            
            document.getElementById(type + '-dashboard').classList.add('active');
            document.getElementById(type + '-btn').classList.add('active');
            
            if (type === 'donor') {
                console.log('Switching to donor dashboard, currentUser:', currentUser);
                loadMyDonations();
            }
            if (type === 'ngo') {
                // Only load donations if NGO is already registered with food types
                if (currentNGO && currentNGO.accepted_food_types && currentNGO.accepted_food_types.length > 0) {
                    loadAvailableDonations();
                } else {
                    // Clear the donations display
                    displayDonations([], 'available-donations', false);
                }
            }
            if (type === 'volunteer') loadVolunteerData();
        }

        // Notifications
        function showNotification(message, type = 'success') {
            const notification = document.createElement('div');
            notification.className = `notification ${type}`;
            notification.textContent = message;
            document.getElementById('notifications').appendChild(notification);
            
            setTimeout(() => notification.remove(), 5000);
        }

        // Geolocation
        function getLocation() {
            if (navigator.geolocation) {
                document.getElementById('location-status').textContent = 'üìç Getting high-accuracy location...';
                navigator.geolocation.getCurrentPosition(
                    (position) => {
                        const accuracy = position.coords.accuracy ? Math.round(position.coords.accuracy) : 999999;
                        
                        // Check if accuracy is acceptable (under 500m)
                        if (accuracy > 500) {
                            document.getElementById('location-status').innerHTML = `
                                <div style="background: #fff3cd; padding: 15px; border-radius: 8px; border: 1px solid #ffc107;">
                                    <p style="margin: 0 0 10px 0; color: #856404;"><strong>‚ö†Ô∏è Low Accuracy Location</strong></p>
                                    <p style="margin: 5px 0; font-size: 0.9em; color: #666;">
                                        Current accuracy: ~${accuracy}m (we recommend under 500m)<br>
                                        Try moving closer to a window or outside for better GPS signal.
                                    </p>
                                    <div style="margin-top: 10px;">
                                        <button type="button" onclick="getLocation()" 
                                                style="padding: 6px 12px; background: #28a745; color: white; border: none; border-radius: 4px; font-size: 0.9em; cursor: pointer; margin-right: 8px;">
                                            üìç Try Again
                                        </button>
                                        <button type="button" onclick="acceptLowAccuracy(${position.coords.latitude}, ${position.coords.longitude}, ${accuracy})" 
                                                style="padding: 6px 12px; background: #ffc107; color: #212529; border: none; border-radius: 4px; font-size: 0.9em; cursor: pointer; margin-right: 8px;">
                                            ‚úÖ Use Anyway
                                        </button>
                                        <button type="button" onclick="showLocationFallback()" 
                                                style="padding: 6px 12px; background: #6c757d; color: white; border: none; border-radius: 4px; font-size: 0.9em; cursor: pointer;">
                                            ‚úèÔ∏è Manual Address
                                        </button>
                                    </div>
                                </div>
                            `;
                            return;
                        }
                        
                        // Good accuracy - proceed normally
                        currentLocation = {
                            latitude: position.coords.latitude,
                            longitude: position.coords.longitude
                        };
                        
                        // Show location preview with embedded map
                        const lat = position.coords.latitude.toFixed(6);
                        const lng = position.coords.longitude.toFixed(6);
                        
                        document.getElementById('location-status').innerHTML = `
                            <div style="background: #e8f5e8; padding: 15px; border-radius: 8px; border: 1px solid #4CAF50;">
                                <p style="margin: 0 0 10px 0; color: #2e7d32;"><strong>‚úÖ High-Accuracy Location Captured!</strong></p>
                                
                                <!-- Embedded Google Map -->
                                <div class="map-container" style="margin: 10px 0;">
                                    <iframe 
                                        width="100%" 
                                        height="200" 
                                        referrerpolicy="no-referrer-when-downgrade" 
                                        src="https://maps.google.com/maps?q=${lat},${lng}&z=16&output=embed"
                                        allowfullscreen>
                                    </iframe>
                                </div>
                                
                                <div class="location-info">
                                    <p style="margin: 2px 0; font-size: 0.9em; color: #555;">
                                        <strong>üìç Coordinates:</strong> ${lat}, ${lng}
                                    </p>
                                    <p style="margin: 2px 0; font-size: 0.9em; color: #28a745;">
                                        <strong>üéØ Accuracy:</strong> ¬±${accuracy}m ‚úÖ
                                    </p>
                                </div>
                                
                                <div style="margin-top: 10px;">
                                    <a href="https://www.google.com/maps?q=${lat},${lng}" target="_blank" 
                                       style="display: inline-block; padding: 6px 12px; background: #4CAF50; color: white; text-decoration: none; border-radius: 4px; font-size: 0.9em; margin-right: 8px;">
                                        üó∫Ô∏è Open in Maps
                                    </a>
                                    <button type="button" onclick="getLocation()" 
                                            style="padding: 6px 12px; background: #2196F3; color: white; border: none; border-radius: 4px; font-size: 0.9em; cursor: pointer;">
                                        üîÑ Refresh Location
                                    </button>
                                </div>
                            </div>
                        `;
                        console.log('High-accuracy location captured:', currentLocation, 'Accuracy:', accuracy + 'm');
                    },
                    (error) => {
                        let errorMessage = 'Location failed';
                        switch(error.code) {
                            case error.PERMISSION_DENIED:
                                errorMessage = 'Location permission denied. You can still post donations without GPS.';
                                break;
                            case error.POSITION_UNAVAILABLE:
                                errorMessage = 'Location unavailable. You can still post donations.';
                                break;
                            case error.TIMEOUT:
                                errorMessage = 'Location timeout. You can still post donations.';
                                break;
                            default:
                                errorMessage = 'Location error. You can still post donations.';
                                break;
                        }
                        document.getElementById('location-status').textContent = '‚ö†Ô∏è ' + errorMessage;
                        console.log('Geolocation error:', error);
                        
                        // Provide manual location option
                        showLocationFallback();
                    },
                    {
                        enableHighAccuracy: true, // Enable high accuracy GPS
                        timeout: 15000, // Longer timeout for better accuracy
                        maximumAge: 60000 // 1 minute cache - fresher location data
                    }
                );
            } else {
                document.getElementById('location-status').textContent = '‚ùå Geolocation not supported';
                showLocationFallback();
            }
        }

        // Accept low accuracy location
        function acceptLowAccuracy(lat, lng, accuracy) {
            currentLocation = {
                latitude: lat,
                longitude: lng
            };
            
            const latFixed = lat.toFixed(6);
            const lngFixed = lng.toFixed(6);
            
            document.getElementById('location-status').innerHTML = `
                <div style="background: #fff3cd; padding: 15px; border-radius: 8px; border: 1px solid #ffc107;">
                    <p style="margin: 0 0 10px 0; color: #856404;"><strong>‚ö†Ô∏è Low-Accuracy Location Accepted</strong></p>
                    
                    <!-- Embedded Google Map -->
                    <div class="map-container" style="margin: 10px 0;">
                        <iframe 
                            width="100%" 
                            height="200" 
                            referrerpolicy="no-referrer-when-downgrade" 
                            src="https://maps.google.com/maps?q=${latFixed},${lngFixed}&z=14&output=embed"
                            allowfullscreen>
                        </iframe>
                    </div>
                    
                    <div class="location-info">
                        <p style="margin: 2px 0; font-size: 0.9em; color: #555;">
                            <strong>üìç Coordinates:</strong> ${latFixed}, ${lngFixed}
                        </p>
                        <p style="margin: 2px 0; font-size: 0.9em; color: #dc3545;">
                            <strong>‚ö†Ô∏è Accuracy:</strong> ¬±${accuracy}m (approximate)
                        </p>
                    </div>
                    
                    <div style="margin-top: 10px;">
                        <a href="https://www.google.com/maps?q=${latFixed},${lngFixed}" target="_blank" 
                           style="display: inline-block; padding: 6px 12px; background: #ffc107; color: #212529; text-decoration: none; border-radius: 4px; font-size: 0.9em; margin-right: 8px;">
                            üó∫Ô∏è Open in Maps
                        </a>
                        <button type="button" onclick="getLocation()" 
                                style="padding: 6px 12px; background: #28a745; color: white; border: none; border-radius: 4px; font-size: 0.9em; cursor: pointer;">
                            üìç Try High Accuracy Again
                        </button>
                    </div>
                </div>
            `;
            console.log('Low-accuracy location accepted:', currentLocation, 'Accuracy:', accuracy + 'm');
        }

        // Show manual location input as fallback
        function showLocationFallback() {
            const locationStatus = document.getElementById('location-status');
            locationStatus.innerHTML = `
                <div style="margin-top: 10px;">
                    <p style="margin: 5px 0;">‚ö†Ô∏è GPS not available. Enter location manually (optional):</p>
                    <input type="text" id="manual-address" placeholder="e.g., 123 Main St, City" style="width: 100%; padding: 8px; margin: 5px 0; border: 1px solid #ddd; border-radius: 4px;">
                    <button type="button" onclick="useManualLocation()" style="padding: 6px 12px; background: #3498db; color: white; border: none; border-radius: 4px; cursor: pointer; margin-right: 10px;">Use This Address</button>
                    <button type="button" onclick="skipLocation()" style="padding: 6px 12px; background: #95a5a6; color: white; border: none; border-radius: 4px; cursor: pointer;">Skip Location</button>
                </div>
            `;
        }

        // Use manual location
        function useManualLocation() {
            const address = document.getElementById('manual-address').value.trim();
            if (address) {
                // For demo purposes, we'll use a default coordinate for manual addresses
                currentLocation = {
                    latitude: 40.7128, // Default to NYC coordinates
                    longitude: -74.0060,
                    manual_address: address
                };
                
                document.getElementById('location-status').innerHTML = `
                    <div style="background: #fff3cd; padding: 15px; border-radius: 8px; border: 1px solid #ffc107;">
                        <p style="margin: 0 0 10px 0; color: #856404;"><strong>‚úÖ Manual Address Set!</strong></p>
                        
                        <!-- Map showing demo location -->
                        <div class="map-container" style="margin: 10px 0;">
                            <iframe 
                                width="100%" 
                                height="180" 
                                referrerpolicy="no-referrer-when-downgrade" 
                                src="https://maps.google.com/maps?q=${encodeURIComponent(address)}&z=14&output=embed"
                                allowfullscreen>
                            </iframe>
                        </div>
                        
                        <div class="location-info">
                            <p style="margin: 2px 0; font-size: 0.9em; color: #555;">
                                <strong>üìç Address:</strong> ${address}
                            </p>
                            <p style="margin: 2px 0; font-size: 0.8em; color: #666; font-style: italic;">
                                üó∫Ô∏è Map shows search result for your address
                            </p>
                        </div>
                        
                        <div style="margin-top: 10px;">
                            <button type="button" onclick="getLocation()" 
                                    style="padding: 6px 12px; background: #28a745; color: white; border: none; border-radius: 4px; font-size: 0.9em; cursor: pointer; margin-right: 8px;">
                                üìç Try GPS Instead
                            </button>
                            <button type="button" onclick="showLocationFallback()" 
                                    style="padding: 6px 12px; background: #6c757d; color: white; border: none; border-radius: 4px; font-size: 0.9em; cursor: pointer;">
                                ‚úèÔ∏è Edit Address
                            </button>
                        </div>
                    </div>
                `;
            } else {
                showNotification('Please enter an address or skip location', 'error');
            }
        }

        // Skip location entirely
        function skipLocation() {
            currentLocation = null;
            document.getElementById('location-status').innerHTML = `
                <div style="background: #f8f9fa; padding: 10px; border-radius: 5px; border: 1px solid #dee2e6;">
                    <p style="margin: 0; color: #6c757d;"><strong>‚ÑπÔ∏è Location Skipped</strong></p>
                    <p style="margin: 5px 0; font-size: 0.9em; color: #666;">
                        Your donation will be posted without GPS coordinates
                    </p>
                    <div style="margin-top: 8px;">
                        <button type="button" onclick="getLocation()" 
                                style="padding: 4px 8px; background: #28a745; color: white; border: none; border-radius: 3px; font-size: 0.8em; cursor: pointer;">
                            üìç Add Location
                        </button>
                    </div>
                </div>
            `;
        }

        // Photo upload
        function handlePhotoUpload(input) {
            const file = input.files[0];
            if (file) {
                const reader = new FileReader();
                reader.onload = function(e) {
                    document.getElementById('photo-preview').innerHTML = 
                        `<img src="${e.target.result}" style="max-width: 200px; max-height: 200px; border-radius: 5px;">`;
                };
                reader.readAsDataURL(file);
            }
        }

        // Donation form submission
        document.getElementById('donation-form').addEventListener('submit', async (e) => {
            e.preventDefault();
            
            // Get selected food types from checkboxes
            const selectedFoodTypes = Array.from(document.querySelectorAll('input[name="donor-food-types"]:checked'))
                .map(checkbox => checkbox.value);
            
            const formData = {
                restaurant_name: document.getElementById('restaurant-name').value,
                food_type: selectedFoodTypes.length > 0 ? selectedFoodTypes.join(', ') : null, // Join multiple types with comma
                food_description: document.getElementById('food-description').value,
                quantity: parseInt(document.getElementById('quantity').value),
                expiry_hours: document.getElementById('expiry-hours').value ? parseInt(document.getElementById('expiry-hours').value) : null,
                latitude: currentLocation?.latitude || null,
                longitude: currentLocation?.longitude || null,
                pickup_address: currentLocation?.manual_address || document.getElementById('restaurant-name').value || 'Address not provided',
                donor_user: currentUser?.username || 'anonymous' // Track which user created this donation
            };

            try {
                const response = await fetch(`${API_BASE}/donations/`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify(formData)
                });

                if (response.ok) {
                    const result = await response.json();
                    showNotification('Donation posted successfully!');
                    
                    // Upload photo if exists
                    const photoInput = document.getElementById('photo-input');
                    if (photoInput.files[0]) {
                        await uploadPhoto(result.id, photoInput.files[0]);
                    }
                    
                    document.getElementById('donation-form').reset();
                    document.getElementById('photo-preview').innerHTML = '';
                    document.getElementById('location-status').textContent = '';
                    currentLocation = null;
                    loadMyDonations();
                    
                    // WebSocket will handle real-time notifications to NGOs
                } else {
                    const errorText = await response.text();
                    console.error('Server error:', errorText);
                    showNotification(`Error posting donation: ${response.status}`, 'error');
                }
            } catch (error) {
                showNotification(`Network error: ${error.message}`, 'error');
                console.error('Error:', error);
            }
        });

        // Upload photo
        async function uploadPhoto(donationId, file) {
            const formData = new FormData();
            formData.append('file', file);

            try {
                await fetch(`${API_BASE}/donations/${donationId}/upload-photo`, {
                    method: 'POST',
                    body: formData
                });
            } catch (error) {
                console.error('Photo upload error:', error);
            }
        }

        // NGO registration
        document.getElementById('ngo-form').addEventListener('submit', async (e) => {
            e.preventDefault();
            
            // Get selected food types from checkboxes
            const selectedFoodTypes = Array.from(document.querySelectorAll('input[name="food-types"]:checked'))
                .map(checkbox => checkbox.value);
            
            const formData = {
                name: document.getElementById('ngo-name').value,
                contact_phone: document.getElementById('ngo-phone').value,
                latitude: currentLocation?.latitude,
                longitude: currentLocation?.longitude,
                accepted_food_types: JSON.stringify(selectedFoodTypes),
                storage_capacity: parseInt(document.getElementById('ngo-capacity').value) || null,
                operating_schedule: document.getElementById('ngo-schedule').value || "24/7"
            };

            try {
                console.log('Sending NGO registration data:', formData);
                const response = await fetch(`${API_BASE}/ngos/`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify(formData)
                });

                console.log('Response status:', response.status);
                console.log('Response headers:', response.headers);

                if (response.ok) {
                    const result = await response.json();
                    console.log('NGO registration result:', result);
                    // Store complete NGO data for filtering
                    currentNGO = {
                        id: result.id,
                        accepted_food_types: selectedFoodTypes, // Store as array, not JSON string
                        ...formData
                    };
                    // Override the JSON string with the actual array
                    currentNGO.accepted_food_types = selectedFoodTypes;
                    console.log('Stored currentNGO:', currentNGO);
                    showNotification('NGO registered successfully!');
                    document.getElementById('ngo-form').reset();
                    
                    // Show NGO food preferences
                    updateNGOFoodPreferencesDisplay();
                    
                    // Reload available donations with filtering
                    loadAvailableDonations();
                } else {
                    const errorText = await response.text();
                    console.error('Server error:', errorText);
                    showNotification(`Error registering NGO: ${response.status} - ${errorText}`, 'error');
                }
            } catch (error) {
                console.error('Network error details:', error);
                showNotification(`Network error: ${error.message}`, 'error');
            }
        });

        // Update NGO food preferences display
        function updateNGOFoodPreferencesDisplay() {
            const preferencesDiv = document.getElementById('ngo-food-preferences');
            const displayDiv = document.getElementById('accepted-food-types-display');
            
            if (currentNGO && currentNGO.accepted_food_types && currentNGO.accepted_food_types.length > 0) {
                preferencesDiv.style.display = 'block';
                displayDiv.innerHTML = '';
                
                // Handle both array and JSON string formats
                let foodTypes = currentNGO.accepted_food_types;
                if (typeof foodTypes === 'string') {
                    try {
                        foodTypes = JSON.parse(foodTypes);
                    } catch (e) {
                        // If not valid JSON, split by comma
                        foodTypes = foodTypes.split(',').map(t => t.trim());
                    }
                }
                
                if (Array.isArray(foodTypes)) {
                    foodTypes.forEach(foodType => {
                        const tag = document.createElement('span');
                        tag.style.cssText = 'background: #2196f3; color: white; padding: 4px 12px; border-radius: 16px; font-size: 0.85em; font-weight: 500;';
                        tag.textContent = foodType;
                        displayDiv.appendChild(tag);
                    });
                }
            } else {
                preferencesDiv.style.display = 'none';
            }
        }

        // Load donations
        async function loadMyDonations() {
            try {
                // console.log('loadMyDonations called');
                // console.log('currentUser:', currentUser);
                // Filter donations by current user
                const url = currentUser?.username ? 
                    `${API_BASE}/donations/?donor_user=${encodeURIComponent(currentUser.username)}` :
                    `${API_BASE}/donations/`;
                // console.log('Fetching URL:', url);
                const response = await fetch(url);
                const donations = await response.json();
                // console.log('Received donations:', donations.length, donations);
                displayDonations(donations, 'my-donations', true);
            } catch (error) {
                // Only show error once to avoid spam
                if (!window.loadDonationsErrorShown) {
                    console.log('Backend server offline - showing demo mode');
                    window.loadDonationsErrorShown = true;
                }
            }
        }

        async function loadAvailableDonations() {
            try {
                const response = await fetch(`${API_BASE}/donations/?status=available`);
                let donations = await response.json();
                
                // console.log('Total available donations:', donations.length);
                // console.log('Current NGO:', currentNGO);
                
                // Only show donations if NGO is registered and has selected food types
                if (!currentNGO || !currentNGO.accepted_food_types || currentNGO.accepted_food_types.length === 0) {
                    // console.log('NGO not registered or no food types selected - showing no donations');
                    displayDonations([], 'available-donations', false);
                    return;
                }
                
                console.log('NGO accepted food types:', currentNGO.accepted_food_types);
                
                // Filter donations based on NGO's accepted food types
                const filteredDonations = donations.filter(donation => {
                    console.log('Checking donation:', donation.restaurant_name, 'Food type:', donation.food_type);
                    
                    // If donation has no food_type, don't show it (require food type match)
                    if (!donation.food_type) {
                        console.log('  -> Hidden (no food type specified)');
                        return false;
                    }
                    
                    // Handle multiple food types in donation (comma-separated)
                    const donationFoodTypes = donation.food_type.split(',').map(type => type.trim());
                    
                    // Check if any of the donation's food types match NGO's accepted types
                    const matches = donationFoodTypes.some(donationType => 
                        currentNGO.accepted_food_types.includes(donationType)
                    );
                    console.log('  -> Donation types:', donationFoodTypes);
                    console.log('  -> Match:', matches);
                    return matches;
                });
                
                console.log('Filtered donations count:', filteredDonations.length);
                displayDonations(filteredDonations, 'available-donations', false);
                
            } catch (error) {
                console.error('Error loading available donations:', error);
            }
        }

        // Display donations
        function displayDonations(donations, containerId, isOwner) {
            const container = document.getElementById(containerId);
            container.innerHTML = '';

            if (donations.length === 0) {
                const emptyMessage = document.createElement('div');
                emptyMessage.style.cssText = 'text-align: center; padding: 40px 20px; color: #666; font-style: italic;';
                
                if (containerId === 'available-donations') {
                    if (!currentNGO || !currentNGO.accepted_food_types || currentNGO.accepted_food_types.length === 0) {
                        emptyMessage.innerHTML = `
                            <h4>üëÜ Register Your NGO First</h4>
                            <p>Please fill out the registration form above and select your accepted food types to see matching donations.</p>
                        `;
                    } else {
                        // Handle both array and string formats for food types
                        let foodTypesDisplay = '';
                        if (Array.isArray(currentNGO.accepted_food_types)) {
                            foodTypesDisplay = currentNGO.accepted_food_types.join(', ');
                        } else if (typeof currentNGO.accepted_food_types === 'string') {
                            try {
                                const parsed = JSON.parse(currentNGO.accepted_food_types);
                                foodTypesDisplay = Array.isArray(parsed) ? parsed.join(', ') : currentNGO.accepted_food_types;
                            } catch (e) {
                                foodTypesDisplay = currentNGO.accepted_food_types;
                            }
                        }
                        
                        emptyMessage.innerHTML = `
                            <h4>üîç No Matching Donations</h4>
                            <p>No donations available that match your accepted food types: <strong>${foodTypesDisplay}</strong></p>
                            <p>Check back later for new donations!</p>
                        `;
                    }
                } else {
                    emptyMessage.innerHTML = `<p>No donations found.</p>`;
                }
                
                container.appendChild(emptyMessage);
                return;
            }

            donations.forEach(donation => {
                const card = document.createElement('div');
                card.className = 'donation-card';
                card.innerHTML = `
                    <h4>${donation.restaurant_name}</h4>
                    <p><strong>Food Type:</strong> ${donation.food_type || 'Not specified'}</p>
                    <p><strong>Description:</strong> ${donation.food_description}</p>
                    <p><strong>Quantity:</strong> ${donation.quantity} servings</p>
                    <p><strong>Expires in:</strong> ${donation.expiry_hours || 'Not specified'} hours</p>
                    <p><strong>Status:</strong> <span class="status ${donation.status}">${donation.status}</span></p>
                    <p><strong>Posted:</strong> ${formatDate(donation.created_at)}</p>
                    ${donation.photo_url ? `<img src="${donation.photo_url.startsWith('/uploads/') ? 'http://127.0.0.1:8000' + donation.photo_url : API_BASE + donation.photo_url}" style="width: 100%; max-height: 200px; object-fit: cover; border-radius: 5px; margin: 10px 0;">` : ''}
                    ${donation.pickup_address ? `<p><strong>üìç Address:</strong> ${donation.pickup_address}</p>` : ''}
                    ${donation.latitude ? `
                        <div style="background: #f8f9fa; padding: 12px; border-radius: 8px; margin: 10px 0; border-left: 4px solid #007bff;">
                            <p style="margin: 0 0 8px 0; font-size: 0.9em;"><strong>üìç Location:</strong> ${donation.latitude.toFixed(4)}, ${donation.longitude.toFixed(4)}</p>
                            
                            <!-- Mini embedded map -->
                            <div class="map-container" style="margin: 8px 0;">
                                <iframe 
                                    width="100%" 
                                    height="150" 
                                    referrerpolicy="no-referrer-when-downgrade" 
                                    src="https://maps.google.com/maps?q=${donation.latitude},${donation.longitude}&z=15&output=embed"
                                    allowfullscreen>
                                </iframe>
                            </div>
                            
                            <a href="https://www.google.com/maps?q=${donation.latitude},${donation.longitude}" target="_blank" 
                               style="display: inline-block; margin-top: 6px; padding: 4px 10px; background: #007bff; color: white; text-decoration: none; border-radius: 4px; font-size: 0.8em;">
                                üó∫Ô∏è Open in Google Maps
                            </a>
                        </div>
                    ` : (donation.pickup_address ? '' : '<p style="color: #6c757d; font-style: italic;">üìç No location provided</p>')}
                    ${!isOwner && donation.status === 'available' ? `<button class="btn" onclick="acceptDonation(${donation.id})">ü§ù Accept Donation</button>` : ''}
                    ${isOwner && donation.status !== 'available' ? `<button class="btn btn-secondary" onclick="trackDonation(${donation.id})">üìç Track Status</button>` : ''}
                `;
                container.appendChild(card);
            });
        }

        // Accept donation
        async function acceptDonation(donationId) {
            if (!currentNGO) {
                showNotification('Please register your NGO first', 'error');
                return;
            }

            try {
                const response = await fetch(`${API_BASE}/pickups/`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ donation_id: donationId, ngo_id: currentNGO.id || currentNGO })
                });

                if (response.ok) {
                    showNotification('Donation accepted! You can now arrange pickup.');
                    // WebSocket will handle instant updates automatically
                } else {
                    showNotification('Error accepting donation', 'error');
                }
            } catch (error) {
                showNotification('Network error', 'error');
            }
        }

        // Load volunteer data
        async function loadVolunteerData() {
            // Load volunteer stats from localStorage
            const savedStats = localStorage.getItem('volunteerStats');
            let stats = { totalAccepted: 0, mealsRescued: 0, impactScore: 0, points: 0, averageRating: 0, deliveryHistory: [] };
            
            if (savedStats) {
                stats = JSON.parse(savedStats);
            }
            
            // Update display
            document.getElementById('volunteer-total-accepted').textContent = stats.totalAccepted;
            document.getElementById('volunteer-meals-rescued').textContent = stats.mealsRescued;
            document.getElementById('volunteer-impact-score').textContent = stats.impactScore;
            document.getElementById('volunteer-points-display').textContent = stats.points;
            
            // Load available donations and rewards
            loadVolunteerDonations();
            loadRewards();
        }

        // Load donations for volunteers
        async function loadVolunteerDonations() {
            try {
                const response = await fetch(`${API_BASE}/donations/available/`);
                const donations = await response.json();
                displayVolunteerDonations(donations);
            } catch (error) {
                console.error('Error loading volunteer donations:', error);
                // Show offline mode with sample data
                displayVolunteerDonations([]);
            }
        }

        // Display volunteer donations
        function displayVolunteerDonations(donations) {
            const container = document.getElementById('volunteer-donation-list');
            
            if (donations.length === 0) {
                container.innerHTML = `
                    <li style="text-align: center; padding: 60px 20px; color: var(--text-secondary); font-size: 1.2rem; font-style: italic;">
                        <div style="font-size: 4rem; margin-bottom: 20px; opacity: 0.5;">üçΩÔ∏è</div>
                        <div>No donations available at the moment.</div>
                        <div style="margin-top: 10px; font-size: 1rem;">Check back soon for new opportunities to help!</div>
                    </li>
                `;
                return;
            }

            container.innerHTML = donations.map(donation => `
                <li style="background: var(--bg-secondary); border: 2px solid transparent; border-radius: 15px; padding: 25px; margin-bottom: 20px; transition: all 0.3s ease; position: relative; overflow: hidden;">
                    <div style="content: ''; position: absolute; top: 0; left: 0; right: 0; height: 4px; background: var(--accent-gradient);"></div>
                    
                    <div style="display: flex; justify-content: space-between; align-items: flex-start; margin-bottom: 15px;">
                        <div>
                            <div style="font-size: 1.5rem; font-weight: bold; color: var(--text-primary); margin-bottom: 5px;">${donation.food_type}</div>
                            <div style="color: var(--secondary-color); font-size: 1.1rem; font-weight: 600;">üìç ${donation.restaurant_name}</div>
                        </div>
                        ${donation.expires_in_hours && donation.expires_in_hours <= 2 ? 
                            '<div style="background: var(--secondary-gradient); color: var(--text-light); padding: 5px 15px; border-radius: 20px; font-size: 0.9rem; font-weight: 600;">üö® Urgent</div>' : ''}
                    </div>
                    
                    <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 15px; margin-bottom: 20px;">
                        <div style="display: flex; align-items: center; gap: 10px;">
                            <span style="font-size: 1.2rem;">üì¶</span>
                            <span style="color: var(--text-secondary);">Quantity: <strong>${donation.quantity}</strong></span>
                        </div>
                        <div style="display: flex; align-items: center; gap: 10px;">
                            <span style="font-size: 1.2rem;">üí∞</span>
                            <span style="color: var(--text-secondary);">Pay: <strong>‚Çπ${donation.discounted_price}</strong></span>
                        </div>
                        <div style="display: flex; align-items: center; gap: 10px;">
                            <span style="font-size: 1.2rem;">‚è∞</span>
                            <span style="color: var(--text-secondary);">Expires: <strong>Soon</strong></span>
                        </div>
                        <div style="display: flex; align-items: center; gap: 10px;">
                            <span style="font-size: 1.2rem;">üìç</span>
                            <a href="https://www.google.com/maps/search/?api=1&query=${encodeURIComponent(donation.pickup_address || 'Location not provided')}" 
                               target="_blank" style="color: var(--primary-color); text-decoration: none; font-weight: 600;">${donation.pickup_address || 'Location not provided'}</a>
                        </div>
                    </div>
                    
                    <div style="display: flex; gap: 15px; margin-top: 20px;">
                        <button onclick="acceptVolunteerDonation(${donation.id}, '${donation.food_type}', '${donation.quantity}')" 
                                style="background: var(--success-gradient); color: var(--text-light); border: none; padding: 12px 25px; border-radius: 25px; cursor: pointer; font-size: 1rem; font-weight: 600; box-shadow: var(--shadow-md); flex: 1;">
                            ‚úÖ Accept & Help
                        </button>
                        <button onclick="showVolunteerDonationDetails(${donation.id})" 
                                style="background: transparent; color: var(--primary-color); border: 2px solid var(--primary-color); padding: 12px 25px; border-radius: 25px; cursor: pointer; font-size: 1rem; font-weight: 600;">
                            üìã Details
                        </button>
                    </div>
                </li>
            `).join('');
        }

        // Accept donation as volunteer
        function acceptVolunteerDonation(donationId, foodType, quantity) {
            // Update volunteer stats
            let stats = JSON.parse(localStorage.getItem('volunteerStats') || '{"totalAccepted": 0, "mealsRescued": 0, "impactScore": 0, "points": 0, "averageRating": 0, "deliveryHistory": []}');
            stats.totalAccepted++;
            stats.mealsRescued += parseInt(quantity) || 1;
            stats.impactScore += Math.floor((parseInt(quantity) || 1) * 10);
            
            // Award points for accepting donation (10 points + 5 points per meal)
            const pointsEarned = 10 + (parseInt(quantity) || 1) * 5;
            stats.points += pointsEarned;
            
            // Simulate delivery completion with rating (in real app, this would be after actual delivery)
            const simulatedRating = Math.random() * (5 - 3.5) + 3.5; // Random rating between 3.5 and 5
            const restaurantName = document.querySelector(`li[data-id='${donationId}'] .donation-restaurant`)?.textContent?.replace('üìç ', '') || 'Demo Restaurant';
            
            // Add to delivery history
            stats.deliveryHistory.push({
                restaurantName: restaurantName,
                rating: Math.round(simulatedRating * 10) / 10,
                deliveryDate: new Date().toLocaleDateString(),
                foodType: foodType
            });
            
            // Update average rating
            const totalRating = stats.deliveryHistory.reduce((sum, delivery) => sum + delivery.rating, 0);
            stats.averageRating = Math.round((totalRating / stats.deliveryHistory.length) * 10) / 10;
            
            localStorage.setItem('volunteerStats', JSON.stringify(stats));
            
            // Update display
            document.getElementById('volunteer-total-accepted').textContent = stats.totalAccepted;
            document.getElementById('volunteer-meals-rescued').textContent = stats.mealsRescued;
            document.getElementById('volunteer-impact-score').textContent = stats.impactScore;
            document.getElementById('volunteer-points-display').textContent = stats.points;
            
            // Show success message with points earned
            showNotification(`üéâ Great! You've accepted the ${foodType} donation and earned ${pointsEarned} points! Rating: ${Math.round(simulatedRating * 10) / 10}‚≠ê`, 'success');
            
            // Reload donations and refresh rewards affordability
            loadVolunteerDonations();
            loadRewards();
        }

        // Show volunteer donation details
        function showVolunteerDonationDetails(donationId) {
            alert('üìã Donation Details:\n\nThis feature will show detailed information about the donation, including:\n‚Ä¢ Pickup instructions\n‚Ä¢ Contact details\n‚Ä¢ Special requirements\n‚Ä¢ Nutritional information\n‚Ä¢ Storage instructions');
        }

        // Refresh volunteer donations
        function refreshVolunteerDonations() {
            showNotification("üîÑ Refreshing donations...", 'success');
            loadVolunteerDonations();
        }

        // Load rewards from API or use fallback data
        async function loadRewards() {
            try {
                // Try to load from your Flask API
                const response = await fetch('http://127.0.0.1:5000/api/rewards');
                const data = await response.json();
                displayRewards(data.rewards);
            } catch (error) {
                console.log('Using restaurant-based rewards system');
                // Generate rewards based on volunteer's delivery history
                const stats = JSON.parse(localStorage.getItem('volunteerStats') || '{"deliveryHistory": [], "averageRating": 0}');
                const restaurantRewards = generateRestaurantRewards(stats);
                displayRewards(restaurantRewards);
            }
        }

        // Generate restaurant discount vouchers based on delivery history and ratings
        function generateRestaurantRewards(stats) {
            const deliveryHistory = stats.deliveryHistory || [];
            const averageRating = stats.averageRating || 0;
            
            // Create a map of restaurants and their delivery count/average rating
            const restaurantMap = {};
            deliveryHistory.forEach(delivery => {
                if (!restaurantMap[delivery.restaurantName]) {
                    restaurantMap[delivery.restaurantName] = {
                        name: delivery.restaurantName,
                        deliveries: 0,
                        totalRating: 0,
                        foodTypes: []
                    };
                }
                restaurantMap[delivery.restaurantName].deliveries++;
                restaurantMap[delivery.restaurantName].totalRating += delivery.rating;
                if (!restaurantMap[delivery.restaurantName].foodTypes.includes(delivery.foodType)) {
                    restaurantMap[delivery.restaurantName].foodTypes.push(delivery.foodType);
                }
            });

            const rewards = [];
            
            // Generate rewards for restaurants the volunteer has delivered from
            Object.values(restaurantMap).forEach((restaurant, index) => {
                const avgRating = restaurant.totalRating / restaurant.deliveries;
                
                // Calculate discount based on rating (3.5-4.0 = 10%, 4.0-4.5 = 15%, 4.5-5.0 = 20%)
                let discountPercent = 10;
                if (avgRating >= 4.5) discountPercent = 20;
                else if (avgRating >= 4.0) discountPercent = 15;
                
                // Points cost based on discount value (higher discounts cost more points)
                const pointsCost = discountPercent * 10 + restaurant.deliveries * 5;
                
                rewards.push({
                    id: index + 1,
                    name: `${discountPercent}% Off at ${restaurant.name}`,
                    description: `ü§ù Thank you gift from ${restaurant.name}! They're offering you ${discountPercent}% discount as appreciation for helping them rescue ${restaurant.deliveries} donation(s). Your excellent ${avgRating.toFixed(1)}‚≠ê service earned this reward!`,
                    points_cost: pointsCost,
                    voucher_code: `THANKYOU${restaurant.name.replace(/\s+/g, '').toUpperCase()}${discountPercent}`,
                    icon: "üçΩÔ∏è",
                    restaurant: restaurant.name,
                    discount: discountPercent,
                    rating: avgRating,
                    deliveries: restaurant.deliveries
                });
            });

            // Add some default rewards for restaurants not yet delivered to
            if (rewards.length < 3) {
                const defaultRestaurants = [
                    { name: "Green Garden Restaurant", icon: "ü•ó" },
                    { name: "Italian Corner", icon: "üçù" },
                    { name: "Spice Palace", icon: "üçõ" },
                    { name: "Fresh Bites Cafe", icon: "ü•™" },
                    { name: "Ocean View Restaurant", icon: "ÔøΩ" }
                ];
                
                defaultRestaurants.forEach((restaurant, index) => {
                    if (!restaurantMap[restaurant.name]) {
                        rewards.push({
                            id: rewards.length + 1,
                            name: `10% Off at ${restaurant.name}`,
                            description: `üåü Help ${restaurant.name} reduce food waste and they'll thank you with a 10% discount! Complete your first delivery from this restaurant to unlock this appreciation voucher.`,
                            points_cost: 150,
                            voucher_code: `WELCOME${restaurant.name.replace(/\s+/g, '').toUpperCase()}`,
                            icon: restaurant.icon,
                            restaurant: restaurant.name,
                            discount: 10,
                            rating: 0,
                            deliveries: 0,
                            isNewRestaurant: true
                        });
                    }
                });
            }

            return rewards;
        }

        // Display rewards in the grid
        function displayRewards(rewards) {
            const container = document.getElementById('rewards-grid');
            const stats = JSON.parse(localStorage.getItem('volunteerStats') || '{"points": 0}');
            const userPoints = stats.points || 0;

            if (rewards.length === 0) {
                container.innerHTML = `
                    <div style="text-align: center; padding: 40px; color: var(--text-secondary); grid-column: 1/-1;">
                        <div style="font-size: 3rem; margin-bottom: 15px;">ÔøΩÔ∏è</div>
                        <div>Complete your first delivery to unlock restaurant discount vouchers!</div>
                        <div style="margin-top: 10px; font-size: 0.9rem;">The more deliveries you complete with high ratings, the better discounts you'll earn!</div>
                    </div>
                `;
                return;
            }

            container.innerHTML = rewards.map(reward => {
                const canAfford = userPoints >= reward.points_cost;
                const cardClass = canAfford ? 'reward-card affordable' : 'reward-card expensive';
                
                // Special styling for new restaurants vs delivered restaurants
                const borderColor = reward.isNewRestaurant ? 'var(--text-secondary)' : 'var(--success-color)';
                const badgeText = reward.isNewRestaurant ? 'üÜï New Restaurant' : `‚úÖ ${reward.deliveries} Deliveries ‚Ä¢ ${reward.rating.toFixed(1)}‚≠ê`;
                
                return `
                    <div class="${cardClass}" style="border-left: 4px solid ${borderColor};">
                        <div style="display: flex; justify-content: space-between; align-items: start; margin-bottom: 10px;">
                            <div class="reward-icon">${reward.icon || 'ÔøΩÔ∏è'}</div>
                            <div style="background: ${reward.isNewRestaurant ? 'var(--light-secondary)' : 'var(--light-success)'}; 
                                        color: ${reward.isNewRestaurant ? 'var(--secondary-color)' : 'var(--success-color)'}; 
                                        padding: 4px 8px; border-radius: 10px; font-size: 0.7rem; font-weight: 600;">
                                ${badgeText}
                            </div>
                        </div>
                        <div class="reward-name">${reward.name}</div>
                        <div class="reward-description">${reward.description}</div>
                        <div class="reward-cost">üíé ${reward.points_cost} Points</div>
                        <button class="redeem-btn" 
                                ${!canAfford ? 'disabled' : ''} 
                                onclick="redeemReward(${reward.id}, '${reward.name}', ${reward.points_cost}, '${reward.voucher_code || 'N/A'}', '${reward.restaurant}', ${reward.discount})">
                            ${canAfford ? `ÔøΩÔ∏è Get ${reward.discount}% Off` : 'üîí Need More Points'}
                        </button>
                    </div>
                `;
            }).join('');
        }

        // Redeem a reward
        async function redeemReward(rewardId, rewardName, pointsCost, voucherCode, restaurantName, discountPercent) {
            const stats = JSON.parse(localStorage.getItem('volunteerStats') || '{"points": 0}');
            
            if (stats.points < pointsCost) {
                showNotification('‚ùå Not enough points to redeem this reward!', 'error');
                return;
            }

            // Deduct points
            stats.points -= pointsCost;
            localStorage.setItem('volunteerStats', JSON.stringify(stats));
            
            // Update display
            document.getElementById('volunteer-points-display').textContent = stats.points;
            
            // Show success message with voucher code
            showNotification(`ü§ù Restaurant appreciation voucher unlocked! Code: ${voucherCode}`, 'success');
            
            // Show detailed redemption popup with restaurant-specific information
            alert(`ÔøΩÔ∏è Restaurant Discount Voucher Redeemed!\n\n` +
                  `Restaurant: ${restaurantName}\n` +
                  `Discount: ${discountPercent}% OFF\n` +
                  `Voucher Code: ${voucherCode}\n\n` +
                  `üì± How to use:\n` +
                  `1. Visit ${restaurantName}\n` +
                  `2. Show this voucher code when ordering\n` +
                  `3. Enjoy your ${discountPercent}% discount!\n\n` +
                  `Points Remaining: ${stats.points}\n\n` +
                  `üí° Tip: Complete more deliveries with high ratings to unlock even better discounts!`);
            
            // Refresh rewards display
            loadRewards();
            
            try {
                // Try to notify the Flask API about the redemption
                await fetch('http://127.0.0.1:5000/api/volunteers/1/redeem_reward', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ 
                        reward_id: rewardId,
                        restaurant_name: restaurantName,
                        discount_percent: discountPercent
                    })
                });
            } catch (error) {
                console.log('API not available, using offline mode');
            }
        }

        // Track donation status (simple alert for now)
        function trackDonation(donationId) {
            // For now, just show a simple alert
            // In a full implementation, this would show detailed tracking info with DD/MM/YYYY dates
            alert(`Tracking donation #${donationId}\n\nThis feature would show pickup and delivery status with timestamps in DD/MM/YYYY format.`);
        }

        // Initialize app
        window.addEventListener('load', () => {
            // Silently initialize WebSocket for instant updates
            initWebSocket();
            
            // Load initial data
            loadMyDonations();
            loadVolunteerData();
        });

        // Reduced auto-refresh interval (WebSocket handles most updates)
        setInterval(() => {
            // Only refresh if WebSocket is not connected (fallback mode)
            if (!websocket || websocket.readyState !== WebSocket.OPEN) {
                console.log('üì° Using fallback polling mode');
                const activeDashboard = document.querySelector('.dashboard.active').id;
                if (activeDashboard === 'donor-dashboard') loadMyDonations();
                if (activeDashboard === 'ngo-dashboard') loadAvailableDonations();
                if (activeDashboard === 'volunteer-dashboard') loadVolunteerData();
            }
        }, 30000);

        // Cleanup WebSocket connection when page unloads
        window.addEventListener('beforeunload', () => {
            if (websocket) {
                websocket.close();
            }
        });
    </script>
</body>
</html>